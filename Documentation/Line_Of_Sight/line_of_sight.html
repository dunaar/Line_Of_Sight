<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>Line_Of_Sight.line_of_sight API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../Line_Of_Sight.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;Line_Of_Sight</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#path_to_package">path_to_package</a>
            </li>
            <li>
                    <a class="variable" href="#RADIUS_RATIO">RADIUS_RATIO</a>
            </li>
            <li>
                    <a class="variable" href="#R_RADIO">R_RADIO</a>
            </li>
            <li>
                    <a class="variable" href="#float32_array">float32_array</a>
            </li>
            <li>
                    <a class="variable" href="#list_float32_array">list_float32_array</a>
            </li>
            <li>
                    <a class="function" href="#horizon_intervisibility_distances">horizon_intervisibility_distances</a>
            </li>
            <li>
                    <a class="function" href="#linspace_numba">linspace_numba</a>
            </li>
            <li>
                    <a class="function" href="#delta_h">delta_h</a>
            </li>
            <li>
                    <a class="function" href="#compute_los_core">compute_los_core</a>
            </li>
            <li>
                    <a class="function" href="#compute_los">compute_los</a>
            </li>
            <li>
                    <a class="function" href="#are_intervisible_core">are_intervisible_core</a>
            </li>
            <li>
                    <a class="function" href="#are_intervisible">are_intervisible</a>
            </li>
            <li>
                    <a class="function" href="#plot_los">plot_los</a>
            </li>
            <li>
                    <a class="variable" href="#cur_fig_num">cur_fig_num</a>
            </li>
            <li>
                    <a class="function" href="#submain">submain</a>
            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../Line_Of_Sight.html">Line_Of_Sight</a><wbr>.line_of_sight    </h1>

                        <div class="docstring"><p>Project: Line_Of_Sight
File   : line_of_sight.py</p>

<p>Author: Pessel Arnaud
Date: 2025-07
Version: 1.1</p>

<p>Description:
    This script calculates intervisibility between two geographic points (origin and targets) using a Digital Terrain Model (DTM) stored in shared memory. 
    It computes the Line of Sight (LOS) between these points, accounting for Earth's curvature and atmospheric refraction, and determines whether topographic obstacles obstruct the view from the origin to the target.</p>

<pre><code>It leverages the Numba library to optimize performance-critical computations and employs shared memory for efficient access to DTM data, minimizing disk I/O operations.

Key Objectives:
- Generate sampled coordinates along the LOS, incorporating geophysical effects such as Earth's curvature and atmospheric refraction.
- Retrieve terrain altitudes from the DTM for each sampled point along the LOS.
- Determine intervisibility by comparing adjusted LOS altitudes with terrain altitudes to identify obstructions.

Use Case:
- Visibility analysis for telecommunications (e.g., antenna placement optimization).

Features:
- High Performance: Uses Numba's JIT compilation to accelerate numerical computations, particularly for LOS sampling and intervisibility checks.
- Shared Memory: Interfaces with a shared-memory DTM for fast and memory-efficient terrain data access.
- Geophysical Accuracy: Accounts for Earth's curvature and a 4/3 refraction model to simulate radio wave propagation.

Dependencies:
- Python 3.x
- NumPy: For numerical operations and array handling.
- Matplotlib: For visualization of LOS and terrain data.
- Numba: For performance optimization of computational loops.
- Local modules: `get_altitudes_dtm_mp` (for DTM access) and `transform_coord` (for coordinate transformations).
</code></pre>

<p>Usage:
    The script requires the following inputs:
    - Shared memory blocks containing DTM tile data, indices, row counts, and column counts.
    - Coordinates (longitude, latitude, altitude) of the origin and target points.
    - Optional resolution parameter (in meters) for sampling the LOS (default: 400 meters).</p>

<pre><code>Example command:


<div class="pdoc-code codehilite">
<pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span><a href="">Line_Of_Sight.line_of_sight</a><span class="w"> </span>--tiles_1d_array<span class="w"> </span>shm1<span class="w"> </span>--tiles_indices<span class="w"> </span>shm2<span class="w"> </span>--tiles_nrows<span class="w"> </span>shm3<span class="w"> </span>--tiles_ncols<span class="w"> </span>shm4<span class="w"> </span>--origin<span class="w"> </span>-3.2<span class="w"> </span><span class="m">47</span>.5<span class="w"> </span><span class="m">30</span><span class="w"> </span>--target<span class="w"> </span>-3.3<span class="w"> </span><span class="m">47</span>.6<span class="w"> </span><span class="m">60</span>
</code></pre>
</div>



Output:
- A boolean value indicating whether the target is visible from the origin (True for visible, False for obstructed).
</code></pre>
</div>

                        <input id="mod-line_of_sight-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-line_of_sight-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">Project: Line_Of_Sight</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">File   : line_of_sight.py</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">Author: Pessel Arnaud</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">Date: 2025-07</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">Version: 1.1</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">Description:</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">    This script calculates intervisibility between two geographic points (origin and targets) using a Digital Terrain Model (DTM) stored in shared memory. </span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    It computes the Line of Sight (LOS) between these points, accounting for Earth&#39;s curvature and atmospheric refraction, and determines whether topographic obstacles obstruct the view from the origin to the target.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    It leverages the Numba library to optimize performance-critical computations and employs shared memory for efficient access to DTM data, minimizing disk I/O operations.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    Key Objectives:</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    - Generate sampled coordinates along the LOS, incorporating geophysical effects such as Earth&#39;s curvature and atmospheric refraction.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    - Retrieve terrain altitudes from the DTM for each sampled point along the LOS.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">    - Determine intervisibility by comparing adjusted LOS altitudes with terrain altitudes to identify obstructions.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    </span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    Use Case:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    - Visibility analysis for telecommunications (e.g., antenna placement optimization).</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    Features:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    - High Performance: Uses Numba&#39;s JIT compilation to accelerate numerical computations, particularly for LOS sampling and intervisibility checks.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    - Shared Memory: Interfaces with a shared-memory DTM for fast and memory-efficient terrain data access.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    - Geophysical Accuracy: Accounts for Earth&#39;s curvature and a 4/3 refraction model to simulate radio wave propagation.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    Dependencies:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    - Python 3.x</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    - NumPy: For numerical operations and array handling.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    - Matplotlib: For visualization of LOS and terrain data.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    - Numba: For performance optimization of computational loops.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    - Local modules: `get_altitudes_dtm_mp` (for DTM access) and `transform_coord` (for coordinate transformations).</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">Usage:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    The script requires the following inputs:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    - Shared memory blocks containing DTM tile data, indices, row counts, and column counts.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    - Coordinates (longitude, latitude, altitude) of the origin and target points.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    - Optional resolution parameter (in meters) for sampling the LOS (default: 400 meters).</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    Example command:</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    ```bash</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    python -m Line_Of_Sight.line_of_sight --tiles_1d_array shm1 --tiles_indices shm2 --tiles_nrows shm3 --tiles_ncols shm4 --origin -3.2 47.5 30 --target -3.3 47.6 60</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    ```</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    Output:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    - A boolean value indicating whether the target is visible from the origin (True for visible, False for obstructed).</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.1&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="c1"># === Built-in ===</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="n">path_to_package</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="k">if</span> <span class="n">path_to_package</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="c1"># If the package path is not already in sys.path, add it</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="c1">#logging.warning(f&quot;Adding package path to sys.path: {path_to_package}&quot;)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path_to_package</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="c1"># === Third-party ===</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">bool_</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">int64</span><span class="p">,</span> <span class="n">jit</span><span class="p">,</span> <span class="n">prange</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">numba.typed</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span> <span class="k">as</span> <span class="n">Numba_List</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">numba.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Array</span><span class="p">,</span> <span class="n">ListType</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="c1"># === Local modules ===</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Line_Of_Sight.get_altitudes_dtm_mp</span><span class="w"> </span><span class="kn">import</span> <span class="n">Shm_Dtm_User</span><span class="p">,</span> <span class="n">get_altitudes_vect_nb</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Line_Of_Sight.transform_coord</span><span class="w"> </span><span class="kn">import</span> <span class="n">R_EARTH</span><span class="p">,</span> <span class="n">cart_to_geo</span><span class="p">,</span> <span class="n">geo_to_cart</span><span class="p">,</span> <span class="n">straight_line_distances</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="c1"># Constants</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="n">RADIUS_RATIO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">4.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>  <span class="c1"># Ratio for atmospheric refraction adjustment (standard 4/3 model for radio waves)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="n">R_RADIO</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">RADIUS_RATIO</span> <span class="o">*</span> <span class="n">R_EARTH</span><span class="p">)</span>  <span class="c1"># Effective Earth radius adjusted for radio propagation</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="c1"># Define Numba types</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="n">float32_array</span>      <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span>  <span class="c1"># 1D float32 array</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="n">list_float32_array</span> <span class="o">=</span> <span class="n">ListType</span><span class="p">(</span><span class="n">float32_array</span><span class="p">)</span>  <span class="c1"># List of 1D float32 arrays</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="k">def</span><span class="w"> </span><span class="nf">horizon_intervisibility_distances</span><span class="p">(</span><span class="n">alts1</span><span class="p">,</span> <span class="n">alts2</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_EARTH</span><span class="p">):</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    Compute the radioelectric horizon distance for intervisibility.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    Parameters:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    - alts1: Altitude of the first point in meters (float32 or float32[:]).</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    - alts2: Altitude(s) of the second point(s) in meters (float32 or float32[:]).</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    - R: Radius for horizon calculation, typically Earth&#39;s radius or adjusted for refraction (float32).</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    Returns:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    - distances: Horizon distances in meters (float32[:]).</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">alts1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">alts2</span><span class="p">)</span>  <span class="c1"># Radioelectric horizon distance</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="k">return</span> <span class="n">distances</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="c1"># Function to generate linearly spaced values optimized with Numba</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">float32</span><span class="p">[:](</span><span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">int64</span><span class="p">),</span> <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="k">def</span><span class="w"> </span><span class="nf">linspace_numba</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    Generate `num` evenly spaced values between `start` and `stop` for LOS sampling.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    </span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    Parameters:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    - start: The starting value of the sequence (float32).</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">    - stop: The end value of the sequence (float32).</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">    - num: Number of samples to generate, must be &gt;= 1 (int64).</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">    </span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">    Returns:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    - result: Array of `num` evenly spaced values in float32 format (float32[:]).</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    </span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">    Notes:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    - Optimized with Numba for performance in iterative computations.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">    - Handles edge case where `num == 1` by setting step to 0.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="n">step</span>   <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">step</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="c1"># Function to compute height adjustments for LOS due to Earth&#39;s curvature and refraction</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">float32</span><span class="p">[:](</span><span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">[:]),</span> <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="k">def</span><span class="w"> </span><span class="nf">delta_h</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">Rr</span><span class="p">,</span> <span class="n">dist_tot</span><span class="p">,</span> <span class="n">dists</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    Compute height adjustments (delta_h) for LOS calculations, accounting for Earth&#39;s curvature and atmospheric refraction.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">    </span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">    Parameters:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">    - Re: Earth&#39;s radius in meters (float32).</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">    - Rr: Radio radius adjusted for atmospheric refraction, typically 4/3 * Re (float32).</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    - dist_tot: Total distance between origin and target points in meters (float32).</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    - dists: Array of distances along the LOS for each sampled point (float32[:]).</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">    </span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    Returns:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">    - dh: Array of height adjustments in meters for each sampled point (float32[:]).</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">    </span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">    Notes:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">    - Uses a parabolic model to approximate the height offset due to curvature and refraction.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">    - If `dist_tot &lt;= 0`, returns an array of zeros to avoid division by zero.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="n">dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dists</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="k">if</span> <span class="n">dist_tot</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="n">dh</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>  <span class="c1"># No adjustment needed for zero or negative distance</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="c1"># Compute central height offset (do) due to curvature and refraction</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="n">do</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Rr</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">dist_tot</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Re</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">dist_tot</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="n">dhc</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">+</span> <span class="n">do</span> <span class="o">-</span> <span class="n">Rr</span>  <span class="c1"># Central height correction</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="c1"># Apply parabolic height adjustment based on distance</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="n">dh</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">dhc</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist_tot</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dists</span> <span class="o">*</span> <span class="p">(</span><span class="n">dist_tot</span> <span class="o">-</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="k">return</span> <span class="n">dh</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="c1"># Core function to compute LOS samples in Cartesian coordinates</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_los_core</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">zs1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="p">):</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">    Compute sampled Cartesian coordinates along the LOS from an origin to multiple target points.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">    </span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">    Parameters:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">    - x0, y0, z0: X, Y, Z-coordinates of the origin point in meters (float32).</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">    - xs1, ys1, zs1: X, Y, Z-coordinates of the target points in meters (float32[:]).</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">    - resolution_m: Sampling resolution along the LOS in meters (float32).</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">    </span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">    Returns:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">    - xs_samples: List of sampled X-coordinates for each LOS (Numba_List).</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">    - ys_samples: List of sampled Y-coordinates for each LOS (Numba_List).</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">    - zs_samples: List of sampled Z-coordinates for each LOS (Numba_List).</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">    - dists_tot: Total Euclidean distances from origin to each target (float32[:]).</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">    </span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">    Notes:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">    - Uses `linspace_numba` to generate evenly spaced samples along each LOS.</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">    - Number of samples is determined based on total distance and resolution.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">    - Parallelized with Numba&#39;s `prange` for performance with multiple targets.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">    - Type signature omitted due to `Numba_List` complexity; relies on Numba&#39;s type inference.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="c1"># Calculate total Euclidean distances from origin to each target</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>    <span class="n">dists_tot</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xs1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ys1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zs1</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>    <span class="c1"># Determine number of samples based on resolution (at least 2 samples)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>    <span class="n">ns_samples</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dists_tot</span> <span class="o">/</span> <span class="n">resolution_m</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>    <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span> <span class="o">=</span> <span class="n">Numba_List</span><span class="p">(),</span> <span class="n">Numba_List</span><span class="p">(),</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>    <span class="n">v_dummy</span> <span class="o">=</span> <span class="n">linspace_numba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="c1"># Initialize numba lists with dummy vector, parallel mode must not be used</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="c1"># Generate sampled coordinates for each LOS</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="n">xs_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linspace_numba</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ns_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="n">ys_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linspace_numba</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">ys1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ns_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">zs_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linspace_numba</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">zs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ns_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="k">return</span> <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="c1"># Function to compute LOS in geographic coordinates and retrieve terrain data</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_los</span><span class="p">(</span><span class="n">tiles_1d_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tiles_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                <span class="n">tiles_nrows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tiles_ncols</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="o">=</span><span class="mf">400.</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">    Compute the LOS in geographic coordinates and retrieve terrain altitudes from the DTM.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">    </span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">    Parameters:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">    - tiles_1d_array, tiles_indices, tiles_nrows, tiles_ncols: DTM arrays for accessing terrain data.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">    - lng0: Longitude of the origin point in degrees (float).</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">    - lat0: Latitude of the origin point in degrees (float).</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">    - alt0: Altitude of the origin point in meters (float).</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">    - lngs1: Longitudes of the target points in degrees (np.array).</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">    - lats1: Latitudes of the target points in degrees (np.array).</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">    - alts1: Altitudes of the target points in meters (np.array).</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">    - resolution_m: Sampling resolution along the LOS in meters, default 400 (float).</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">    </span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">    Returns:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">    - lngss: Lists of sampled longitudes along each LOS (Numba_List).</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">    - latss: Lists of sampled latitudes along each LOS (Numba_List).</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">    - altss_los: Lists of sampled altitudes along each LOS (Numba_List).</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">    - altss_relief: Lists of terrain altitudes from the DTM for each LOS (Numba_List).</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">    - xs_samples: Lists of sampled X-coordinates in Cartesian (Numba_List).</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">    - ys_samples: Lists of sampled Y-coordinates in Cartesian (Numba_List).</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">    - zs_samples: Lists of sampled Z-coordinates in Cartesian (Numba_List).</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">    - dists_tot: Total distances from origin to each target (np.array).</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">    </span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">    Notes:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">    - Converts geographic coordinates to Cartesian for LOS computation, then back to geographic for DTM queries.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">    - Uses shared memory to efficiently retrieve terrain altitudes.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>    <span class="c1"># Convert origin and target points to Cartesian coordinates</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span>     <span class="o">=</span> <span class="n">geo_to_cart</span><span class="p">(</span><span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>    <span class="n">xs1</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">zs1</span>  <span class="o">=</span> <span class="n">geo_to_cart</span><span class="p">(</span><span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="c1"># Compute sampled Cartesian coordinates along the LOS</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>    <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span> <span class="o">=</span> <span class="n">compute_los_core</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">zs1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="c1"># Initialize lists for geographic coordinates and terrain altitudes</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>    <span class="n">lngss</span>        <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>    <span class="n">latss</span>        <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>    <span class="n">altss_los</span>    <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="n">altss_relief</span> <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">)):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="c1"># Convert sampled Cartesian coordinates back to geographic</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="n">lngs</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">alts</span> <span class="o">=</span> <span class="n">cart_to_geo</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ys_samples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="n">lngss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lngs</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="n">latss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="n">altss_los</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alts</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="c1"># Retrieve terrain altitudes from DTM for the sampled points</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="n">altss_relief</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_altitudes_vect_nb</span><span class="p">(</span><span class="n">tiles_1d_array</span><span class="p">,</span> <span class="n">tiles_indices</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>                                                      <span class="n">tiles_nrows</span><span class="p">,</span> <span class="n">tiles_ncols</span><span class="p">,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                                                      <span class="n">lngs</span><span class="p">,</span> <span class="n">lats</span><span class="p">))</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="c1"># Force type of the numba list which is empty ! </span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="n">dummy_array_float32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">lngss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_float32</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="n">lngss</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">latss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_float32</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">latss</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">altss_los</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_float32</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">altss_los</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">dummy_array_uint16</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">altss_relief</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_uint16</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="n">altss_relief</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>    
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="k">return</span> <span class="n">lngss</span><span class="p">,</span> <span class="n">latss</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="c1"># Core function to determine intervisibility</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="k">def</span><span class="w"> </span><span class="nf">are_intervisible_core</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">ys_samples</span>  <span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>                          <span class="n">altss_los</span> <span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">float32</span><span class="p">,</span> <span class="n">dists_tot</span><span class="p">:</span> <span class="n">float32</span><span class="p">[:])</span> <span class="o">-&gt;</span> <span class="n">bool_</span><span class="p">[:]:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">    Determine if target points are intervisible from the origin, considering terrain and geophysical effects.</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">    </span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">    Parameters:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">    - xs_samples: Lists of sampled X-coordinates along each LOS (Numba_List).</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">    - ys_samples: Lists of sampled Y-coordinates along each LOS (Numba_List).</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    - zs_samples: Lists of sampled Z-coordinates along each LOS (Numba_List).</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">    - altss_los : Lists of altitudes along each LOS (Numba_List).</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">    - altss_relief: Lists of terrain altitudes from the DTM (Numba_List).</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">    - R: Radius adjusted for refraction in meters (float32).</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">    - dists_tot: Total distances from origin to each target in meters (float32[:]).</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">    </span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">    Returns:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">    - result: Boolean array indicating intervisibility, True if visible (bool_[:]).</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">    </span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">    Notes:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">    - Adjusts LOS altitudes with `delta_h` to account for Earth&#39;s curvature and refraction.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">    - Checks if any terrain altitude exceeds the adjusted LOS altitude, indicating an obstruction.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">    - Parallelized with Numba&#39;s `prange` for performance with multiple targets.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">))</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="c1"># Calculate distances along the LOS from the origin</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>                        <span class="p">(</span><span class="n">ys_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ys_samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                        <span class="p">(</span><span class="n">zs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">zs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="c1"># Compute height adjustments for curvature and refraction</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="n">dh</span> <span class="o">=</span> <span class="n">delta_h</span><span class="p">(</span><span class="n">R_EARTH</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">dists_tot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="c1"># Adjust LOS altitudes and compare with terrain altitudes</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="n">alts_adj</span> <span class="o">=</span> <span class="n">altss_los</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dh</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">altss_relief</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">alts_adj</span><span class="p">)</span>  <span class="c1"># True if no terrain exceeds adjusted LOS</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="c1"># Function to check intervisibility using the DTM</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="k">def</span><span class="w"> </span><span class="nf">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">):</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">    Check if target points are intervisible from the origin point using the DTM.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">    </span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">    Parameters:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">    - tiles_1d_array, tiles_indices, tiles_nrows, tiles_ncols: DTM arrays for terrain data access.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">    - lng0: Longitude of the origin point in degrees (float).</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">    - lat0: Latitude of the origin point in degrees (float).</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">    - alt0: Altitude of the origin point in meters (float).</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">    - lngs1: Longitudes of the target points in degrees (np.array).</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">    - lats1: Latitudes of the target points in degrees (np.array).</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">    - alts1: Altitudes of the target points in meters (np.array).</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">    - resolution_m: Sampling resolution along the LOS in meters, default 400 (float).</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">    - R: Radius adjusted for refraction in meters, default R_RADIO (float32).</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    </span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">    Returns:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">    - result: Boolean array indicating intervisibility for each target, True if visible (np.array).</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">    </span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">    Notes:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">    - Orchestrates LOS computation and intervisibility check by calling `compute_los` and `are_intervisible_core`.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">    - Ensures efficient terrain data access via shared memory.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>  <span class="c1"># Ensure radius is float32 for consistency</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="c1"># Compute horizon intervisibilities</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="n">distances</span>           <span class="o">=</span> <span class="n">straight_line_distances</span><span class="p">(</span><span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="n">intervisi_distances</span> <span class="o">=</span> <span class="n">horizon_intervisibility_distances</span><span class="p">(</span><span class="n">alt0</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="c1">#logging.info((&#39;R, distances[0], intervisi_distances[0]&#39;, R, distances[0], intervisi_distances[0]))</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>    <span class="n">intervisibilities</span>   <span class="o">=</span> <span class="p">(</span><span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">intervisi_distances</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>    <span class="k">if</span> <span class="n">intervisibilities</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="n">intervisi_args</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">intervisibilities</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="c1"># Compute LOS samples and retrieve terrain altitudes</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span> <span class="o">=</span> <span class="n">lngs1</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">],</span> <span class="n">lats1</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">],</span> <span class="n">alts1</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">]</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="n">lngss</span><span class="p">,</span> <span class="n">latss</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">dists</span> <span class="o">=</span> <span class="n">compute_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_1d_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_indices_array</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                                                                               <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_nrows_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_ncols_array</span><span class="p">,</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                                                                               <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="n">relief_intervisibilities</span> <span class="o">=</span> <span class="n">are_intervisible_core</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="n">intervisibilities</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">]</span> <span class="o">=</span> <span class="n">relief_intervisibilities</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="k">return</span> <span class="n">intervisibilities</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="c1"># Main execution block</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="c1"># Function to plot the line of sight</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lng1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">alt1</span><span class="p">,</span> <span class="n">resolution_meters</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">):</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">    Plot the Line of Sight (LOS) between two points, showing terrain and LOS altitudes.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">    </span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">    Parameters:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    - shm_dtm_user: Shared memory DTM user object for terrain data access (Shm_Dtm_User).</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">    - lng0: Longitude of the origin point in degrees (float).</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">    - lat0: Latitude of the origin point in degrees (float).</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">    - alt0: Altitude of the origin point in meters (float).</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">    - lng1: Longitude of the target point in degrees (float).</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    - lat1: Latitude of the target point in degrees (float).</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">    - alt1: Altitude of the target point in meters (float).</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">    - resolution_meters: Sampling resolution along the LOS in meters, default 400 (float).</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">    - R: Radius adjusted for refraction in meters, default R_RADIO (float32).</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">    </span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">    Returns:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">    - dist: Total distance from origin to target in meters (float).</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">    </span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">    Notes:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">    - Plots terrain relief and LOS altitudes against distance, longitude, and latitude.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">    - Uses shared memory DTM for terrain data access.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">    - alts_virt and straight are set to 0 and unused in active plotting.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">    - Suggestion: Remove commented-out plt.plot lines and unused alts_virt/straight if not needed.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>    <span class="c1">#logging.info(f&#39;[lng0, lat0, alt0], [lng1, lat1, alt1], resolution_meters:\n{[lng0, lat0, alt0]}\n{[lng1, lat1, alt1]}\n{resolution_meters}&#39;)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>    <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lng1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alt1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="n">lngss_los</span><span class="p">,</span> <span class="n">latss_los</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span> <span class="o">=</span> \
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="n">compute_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_1d_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_indices_array</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                    <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_nrows_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_ncols_array</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                    <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_meters</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="n">x_samples</span><span class="p">,</span> <span class="n">y_samples</span><span class="p">,</span> <span class="n">z_samples</span> <span class="o">=</span> <span class="n">xs_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zs_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1"># note: keeping the 1s and unique target point</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="n">lngs_los</span><span class="p">,</span> <span class="n">lats_los</span><span class="p">,</span> <span class="n">alts_los</span><span class="p">,</span> <span class="n">alts_relief</span> <span class="o">=</span> <span class="n">lngss_los</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latss_los</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">altss_los</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">altss_relief</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># note: keeping the 1s and unique target point</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="n">dists</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_samples</span> <span class="o">-</span> <span class="n">x_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_samples</span> <span class="o">-</span> <span class="n">y_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_samples</span> <span class="o">-</span> <span class="n">z_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="n">dh</span>        <span class="o">=</span> <span class="n">delta_h</span><span class="p">(</span><span class="n">R_EARTH</span><span class="p">,</span> <span class="n">R_EARTH</span><span class="o">*</span><span class="n">RADIUS_RATIO</span><span class="p">,</span> <span class="n">dists_tot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>    <span class="n">alts_los</span> <span class="o">+=</span> <span class="n">dh</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>    <span class="n">alts_virt</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># R_EARTH**2/np.sqrt(R_EARTH**2-(dists-dist_tot/2)**2) - R_EARTH</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="n">straight</span>  <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># np.interp(dists, [dists[0], dists[-1]], [alts_los[0] - alts_virt[0], 0])</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="c1"># plt.plot(dists, alts_relief-alts_los+0 +straight, &#39;b.-&#39;, label=&#39;relief&#39;)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="c1"># plt.plot(dists, alts_los   -alts_los+dh+straight, &#39;k.-&#39;, label=&#39;line of sight&#39;)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="c1"># Note: Above plt.plot lines are commented out and unused.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    <span class="c1"># Suggestion: Remove if not intended for future use.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>    <span class="n">fig</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">alts_relief</span><span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;relief&#39;</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">alts_los</span>   <span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;line of sight&#39;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (m)&#39;</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Altitude (m)&#39;</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="c1"># Shows gridlines for both major and minor ticks</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lngs_los</span><span class="p">,</span> <span class="n">alts_relief</span><span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lngs_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lngs_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lngs_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lngs_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="c1"># Shows gridlines for both major and minor ticks</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>    
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lats_los</span><span class="p">,</span> <span class="n">alts_relief</span><span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lats_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lats_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lats_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lats_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="c1"># Shows gridlines for both major and minor ticks</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>    <span class="k">return</span> <span class="n">dists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="n">cur_fig_num</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="k">def</span><span class="w"> </span><span class="nf">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">    Test intervisibility for multiple points with visualization using shared memory DTM.</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">    </span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">    Parameters:</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">    - shm_dtm_user: Shared memory DTM user object for terrain data access (Shm_Dtm_User).</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">    - m1: Named tuple with lon, lat, alt for the origin point.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">    - m2, m3: Named tuples with lon, lat, alt defining the range of target points.</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">    - n_points: Number of points to generate in the grid (default: 1000).</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">    </span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">    Notes:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">    - Generates a grid of target points and checks intervisibility.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">    - Includes visualization using Matplotlib, which may be unnecessary in CLI context.</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>    <span class="k">global</span> <span class="n">cur_fig_num</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;------------- submain&#39;</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="c1"># Define origin point</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="n">m23_lngs</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="n">m23_lats</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>    <span class="n">m23_alts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Perform intervisibility check: </span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="s1"> ; (</span><span class="si">{</span><span class="n">m2</span><span class="o">.</span><span class="n">lon</span><span class="si">}</span><span class="s1">..</span><span class="si">{</span><span class="n">m3</span><span class="o">.</span><span class="n">lon</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m2</span><span class="o">.</span><span class="n">lat</span><span class="si">}</span><span class="s1">..</span><span class="si">{</span><span class="n">m3</span><span class="o">.</span><span class="n">lat</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m2</span><span class="o">.</span><span class="n">alt</span><span class="si">}</span><span class="s1">..</span><span class="si">{</span><span class="n">m3</span><span class="o">.</span><span class="n">alt</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>    <span class="n">distances</span>           <span class="o">=</span> <span class="n">straight_line_distances</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_lngs</span><span class="p">,</span> <span class="n">m23_lats</span><span class="p">,</span> <span class="n">m23_alts</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>    <span class="n">intervisi_distances</span> <span class="o">=</span> <span class="n">horizon_intervisibility_distances</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_alts</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="c1"># Test vectorized intervisibility</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>    <span class="n">intervisibilities</span>   <span class="o">=</span> <span class="n">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_lngs</span><span class="p">,</span> <span class="n">m23_lats</span><span class="p">,</span> <span class="n">m23_alts</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>    <span class="n">execution_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time for intervisibility check: </span><span class="si">{</span><span class="n">execution_time</span><span class="o">*</span><span class="mf">1000.</span><span class="si">:</span><span class="s1">10.3f</span><span class="si">}</span><span class="s1">ms&#39;</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>    <span class="c1"># Initialize plot</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="n">cur_fig_num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;los</span><span class="si">{</span><span class="n">cur_fig_num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>    <span class="n">r_</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- [</span><span class="si">{</span><span class="n">idx</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">] Dist intervisi theo: </span><span class="si">{</span><span class="p">(</span><span class="n">intervisi_distances</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span><span class="si">:</span><span class="s1">8.3f</span><span class="si">}</span><span class="s1"> km&#39;</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;         Dist entre points  : </span><span class="si">{</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span><span class="si">:</span><span class="s1">8.3f</span><span class="si">}</span><span class="s1"> km&#39;</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;         Intervisibility    : </span><span class="si">{</span><span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="n">plot_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_lngs</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m23_lats</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m23_alts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="c1"># Note: Legend removal is redundant as plot_los manages legends.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    <span class="c1"># Suggestion: Remove this line as it may raise an error if no legend exists.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="c1"># Main function to handle CLI arguments and execute intervisibility check</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">    Parse command-line arguments and execute the intervisibility computation.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">    </span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">    Notes:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">    - Initializes the shared memory DTM interface.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">    - Processes input coordinates and resolution.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">    - Outputs the intervisibility result and cleans up resources.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">    - Calls submain and submain2 for additional testing.</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>    <span class="c1"># Define CLI argument parser with detailed help messages</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Calculate Line of Sight (LOS) intervisibility using shared memory DTM.&#39;</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="n">epilog</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="s1">Example:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="s1">    python -m Line_Of_Sight.line_of_sight --tiles_1d_array shm1 --tiles_indices shm2 --tiles_nrows shm3 --tiles_ncols shm4 --origin -3.2 47.5 30 --target -3.3 47.6 60</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="s1">Notes:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="s1">    - Shared memory blocks must be pre-allocated and accessible.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="s1">    - Coordinates should be provided in decimal degrees (longitude, latitude) and meters (altitude).</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="s1">    - Resolution affects the granularity of LOS sampling; lower values increase accuracy but increase computation time.</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="s1">&#39;&#39;&#39;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>    <span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>    <span class="c1"># Define required and optional arguments</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_1d_array&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing DTM tile data&#39;</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_indices&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing tile indices&#39;</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_nrows&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing tile row counts&#39;</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_ncols&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing tile column counts&#39;</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--origin&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LON&#39;</span><span class="p">,</span> <span class="s1">&#39;LAT&#39;</span><span class="p">,</span> <span class="s1">&#39;ALT&#39;</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Origin point coordinates: longitude (degrees), latitude (degrees), altitude (meters)&#39;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--target&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LON&#39;</span><span class="p">,</span> <span class="s1">&#39;LAT&#39;</span><span class="p">,</span> <span class="s1">&#39;ALT&#39;</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Target point coordinates: longitude (degrees), latitude (degrees), altitude (meters)&#39;</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--resolution&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Sampling resolution along the LOS in meters (default: 400)&#39;</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>    <span class="c1"># Parse command-line arguments</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>    
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>    <span class="c1"># Initialize shared memory DTM interface with provided blocks</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">resource_tracker</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>    <span class="n">resource_tracker</span><span class="o">.</span><span class="n">register</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">rtype</span><span class="p">:</span> <span class="kc">None</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>    
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>    <span class="n">shm_dtm_user</span> <span class="o">=</span> <span class="n">Shm_Dtm_User</span><span class="p">({</span><span class="s2">&quot;tiles_1d_array&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_1d_array</span><span class="p">,</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>                                 <span class="s2">&quot;tiles_indices&quot;</span> <span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_indices</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>                                 <span class="s2">&quot;tiles_nrows&quot;</span>   <span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_nrows</span><span class="p">,</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>                                 <span class="s2">&quot;tiles_ncols&quot;</span>   <span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_ncols</span><span class="p">})</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>    <span class="c1"># Run test functions</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>    <span class="n">Point</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;alt&#39;</span><span class="p">])</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>    <span class="n">resolution_m</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>    <span class="c1"># Warm up the JIT compiler</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="n">m1</span>  <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">180.</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>    <span class="n">m2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">10000.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>    <span class="n">intervisibilities</span>   <span class="o">=</span> <span class="n">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m2s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m2s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m2s</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">origin</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="n">m1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="n">m2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="n">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="n">m1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">12.2</span><span class="p">,</span> <span class="mf">47.5</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>    <span class="n">m2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">6.0</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="mf">6.1</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="mf">10.</span><span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>    <span class="n">m3</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">6.3</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="mf">6.4</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="mf">100.</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>    <span class="n">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>    <span class="n">m1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">4.42</span><span class="p">,</span> <span class="mf">48.38</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="n">m3</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">4.47</span><span class="p">,</span> <span class="mf">47.94</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>    <span class="n">m2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">0.9</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">alt</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>    <span class="n">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>    <span class="c1"># Loop to test intervisibility for multiple random points</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Testing intervisibility for multiple random points...&#39;</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>    <span class="n">m1_size</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>    <span class="n">m1s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span>   <span class="mf">180.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">m1_size</span><span class="p">),</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span> <span class="o">-</span><span class="mf">80.</span><span class="p">,</span>    <span class="mf">80.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">m1_size</span><span class="p">),</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">20000.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">m1_size</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>    <span class="n">m2_size</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>    <span class="n">deviations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">m1_size</span><span class="p">,</span> <span class="n">m2_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>    <span class="n">m2ss</span> <span class="o">=</span> <span class="n">m1s</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="n">deviations</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>    <span class="n">execution_times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">m2_size</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">m2_size</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Compute intervisibility and measure execution time for each point&quot;</span><span class="p">):</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="c1"># For each point, compute intervisibility and measure execution time</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="n">intervisibilities</span> <span class="o">=</span> <span class="n">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>                                             <span class="n">m1s</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m1s</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m1s</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>                                             <span class="n">m2ss</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m2ss</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m2ss</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="n">execution_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">execution_time</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>    
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>    <span class="n">execution_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.</span>  <span class="c1"># Convert to milliseconds</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of time entries             : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of line-of-sight per entries: </span><span class="si">{</span><span class="n">m2_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total time                         : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean time                          : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard deviation                 : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum time                       : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum time                       : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;99th percentile time               : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">execution_times</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>    <span class="c1"># Close shared memory resources to prevent memory leaks</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>    <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>    <span class="c1"># === Built-in ===</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>    <span class="c1"># === Third-party ===</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>    <span class="c1"># Configure logging only when running as main script</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">-</span><span class="si">%(levelname)s</span><span class="s1">-</span><span class="si">%(processName)s</span><span class="s1">-</span><span class="si">%(module)s</span><span class="s1">-</span><span class="si">%(funcName)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>        <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()]</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>    <span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close_figures</span><span class="p">():</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>        <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fignum</span><span class="p">)</span> <span class="k">for</span> <span class="n">fignum</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">())</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>    
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_figures</span><span class="p">():</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="k">for</span> <span class="n">fignum</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">():</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;figure_</span><span class="si">{</span><span class="n">fig</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>    <span class="n">main</span><span class="p">()</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>    <span class="n">save_figures</span><span class="p">()</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="c1"># ======================================================================</span>
</span></pre></div>


            </section>
                <section id="path_to_package">
                    <div class="attr variable">
            <span class="name">path_to_package</span>        =
<span class="default_value">&#39;/home/arnaud/Projets/Line_Of_Sight&#39;</span>

        
    </div>
    <a class="headerlink" href="#path_to_package"></a>
    
    

                </section>
                <section id="RADIUS_RATIO">
                    <div class="attr variable">
            <span class="name">RADIUS_RATIO</span>        =
<span class="default_value">np.float32(1.3333334)</span>

        
    </div>
    <a class="headerlink" href="#RADIUS_RATIO"></a>
    
    

                </section>
                <section id="R_RADIO">
                    <div class="attr variable">
            <span class="name">R_RADIO</span>        =
<span class="default_value">np.float32(8494667.0)</span>

        
    </div>
    <a class="headerlink" href="#R_RADIO"></a>
    
    

                </section>
                <section id="float32_array">
                    <div class="attr variable">
            <span class="name">float32_array</span>        =
<span class="default_value">Array(float32, 1, &#39;C&#39;, False, aligned=True)</span>

        
    </div>
    <a class="headerlink" href="#float32_array"></a>
    
    

                </section>
                <section id="list_float32_array">
                    <div class="attr variable">
            <span class="name">list_float32_array</span>        =
<span class="default_value">ListType(array(float32, 1d, C))</span>

        
    </div>
    <a class="headerlink" href="#list_float32_array"></a>
    
    

                </section>
                <section id="horizon_intervisibility_distances">
                            <input id="horizon_intervisibility_distances-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-jit">@jit(nopython=True, cache=True)</div>

        <span class="def">def</span>
        <span class="name">horizon_intervisibility_distances</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">alts1</span>, </span><span class="param"><span class="n">alts2</span>, </span><span class="param"><span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">6371000.0</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="horizon_intervisibility_distances-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#horizon_intervisibility_distances"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="horizon_intervisibility_distances-84"><a href="#horizon_intervisibility_distances-84"><span class="linenos">84</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="horizon_intervisibility_distances-85"><a href="#horizon_intervisibility_distances-85"><span class="linenos">85</span></a><span class="k">def</span><span class="w"> </span><span class="nf">horizon_intervisibility_distances</span><span class="p">(</span><span class="n">alts1</span><span class="p">,</span> <span class="n">alts2</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_EARTH</span><span class="p">):</span>
</span><span id="horizon_intervisibility_distances-86"><a href="#horizon_intervisibility_distances-86"><span class="linenos">86</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="horizon_intervisibility_distances-87"><a href="#horizon_intervisibility_distances-87"><span class="linenos">87</span></a><span class="sd">    Compute the radioelectric horizon distance for intervisibility.</span>
</span><span id="horizon_intervisibility_distances-88"><a href="#horizon_intervisibility_distances-88"><span class="linenos">88</span></a>
</span><span id="horizon_intervisibility_distances-89"><a href="#horizon_intervisibility_distances-89"><span class="linenos">89</span></a><span class="sd">    Parameters:</span>
</span><span id="horizon_intervisibility_distances-90"><a href="#horizon_intervisibility_distances-90"><span class="linenos">90</span></a><span class="sd">    - alts1: Altitude of the first point in meters (float32 or float32[:]).</span>
</span><span id="horizon_intervisibility_distances-91"><a href="#horizon_intervisibility_distances-91"><span class="linenos">91</span></a><span class="sd">    - alts2: Altitude(s) of the second point(s) in meters (float32 or float32[:]).</span>
</span><span id="horizon_intervisibility_distances-92"><a href="#horizon_intervisibility_distances-92"><span class="linenos">92</span></a><span class="sd">    - R: Radius for horizon calculation, typically Earth&#39;s radius or adjusted for refraction (float32).</span>
</span><span id="horizon_intervisibility_distances-93"><a href="#horizon_intervisibility_distances-93"><span class="linenos">93</span></a>
</span><span id="horizon_intervisibility_distances-94"><a href="#horizon_intervisibility_distances-94"><span class="linenos">94</span></a><span class="sd">    Returns:</span>
</span><span id="horizon_intervisibility_distances-95"><a href="#horizon_intervisibility_distances-95"><span class="linenos">95</span></a><span class="sd">    - distances: Horizon distances in meters (float32[:]).</span>
</span><span id="horizon_intervisibility_distances-96"><a href="#horizon_intervisibility_distances-96"><span class="linenos">96</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="horizon_intervisibility_distances-97"><a href="#horizon_intervisibility_distances-97"><span class="linenos">97</span></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">alts1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">alts2</span><span class="p">)</span>  <span class="c1"># Radioelectric horizon distance</span>
</span><span id="horizon_intervisibility_distances-98"><a href="#horizon_intervisibility_distances-98"><span class="linenos">98</span></a>    <span class="k">return</span> <span class="n">distances</span>
</span></pre></div>


            <div class="docstring"><p>Compute the radioelectric horizon distance for intervisibility.</p>

<p>Parameters:</p>

<ul>
<li>alts1: Altitude of the first point in meters (float32 or float32[:]).</li>
<li>alts2: Altitude(s) of the second point(s) in meters (float32 or float32[:]).</li>
<li>R: Radius for horizon calculation, typically Earth's radius or adjusted for refraction (float32).</li>
</ul>

<p>Returns:</p>

<ul>
<li>distances: Horizon distances in meters (float32[:]).</li>
</ul>
</div>


                </section>
                <section id="linspace_numba">
                            <input id="linspace_numba-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-jit">@jit(float32[:](float32, float32, int64), nopython=True, cache=True)</div>

        <span class="def">def</span>
        <span class="name">linspace_numba</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">start</span>, </span><span class="param"><span class="n">stop</span>, </span><span class="param"><span class="n">num</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="linspace_numba-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#linspace_numba"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="linspace_numba-101"><a href="#linspace_numba-101"><span class="linenos">101</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">float32</span><span class="p">[:](</span><span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">int64</span><span class="p">),</span> <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="linspace_numba-102"><a href="#linspace_numba-102"><span class="linenos">102</span></a><span class="k">def</span><span class="w"> </span><span class="nf">linspace_numba</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span id="linspace_numba-103"><a href="#linspace_numba-103"><span class="linenos">103</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="linspace_numba-104"><a href="#linspace_numba-104"><span class="linenos">104</span></a><span class="sd">    Generate `num` evenly spaced values between `start` and `stop` for LOS sampling.</span>
</span><span id="linspace_numba-105"><a href="#linspace_numba-105"><span class="linenos">105</span></a><span class="sd">    </span>
</span><span id="linspace_numba-106"><a href="#linspace_numba-106"><span class="linenos">106</span></a><span class="sd">    Parameters:</span>
</span><span id="linspace_numba-107"><a href="#linspace_numba-107"><span class="linenos">107</span></a><span class="sd">    - start: The starting value of the sequence (float32).</span>
</span><span id="linspace_numba-108"><a href="#linspace_numba-108"><span class="linenos">108</span></a><span class="sd">    - stop: The end value of the sequence (float32).</span>
</span><span id="linspace_numba-109"><a href="#linspace_numba-109"><span class="linenos">109</span></a><span class="sd">    - num: Number of samples to generate, must be &gt;= 1 (int64).</span>
</span><span id="linspace_numba-110"><a href="#linspace_numba-110"><span class="linenos">110</span></a><span class="sd">    </span>
</span><span id="linspace_numba-111"><a href="#linspace_numba-111"><span class="linenos">111</span></a><span class="sd">    Returns:</span>
</span><span id="linspace_numba-112"><a href="#linspace_numba-112"><span class="linenos">112</span></a><span class="sd">    - result: Array of `num` evenly spaced values in float32 format (float32[:]).</span>
</span><span id="linspace_numba-113"><a href="#linspace_numba-113"><span class="linenos">113</span></a><span class="sd">    </span>
</span><span id="linspace_numba-114"><a href="#linspace_numba-114"><span class="linenos">114</span></a><span class="sd">    Notes:</span>
</span><span id="linspace_numba-115"><a href="#linspace_numba-115"><span class="linenos">115</span></a><span class="sd">    - Optimized with Numba for performance in iterative computations.</span>
</span><span id="linspace_numba-116"><a href="#linspace_numba-116"><span class="linenos">116</span></a><span class="sd">    - Handles edge case where `num == 1` by setting step to 0.</span>
</span><span id="linspace_numba-117"><a href="#linspace_numba-117"><span class="linenos">117</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="linspace_numba-118"><a href="#linspace_numba-118"><span class="linenos">118</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="linspace_numba-119"><a href="#linspace_numba-119"><span class="linenos">119</span></a>    <span class="n">step</span>   <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span>
</span><span id="linspace_numba-120"><a href="#linspace_numba-120"><span class="linenos">120</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="linspace_numba-121"><a href="#linspace_numba-121"><span class="linenos">121</span></a>        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">step</span>
</span><span id="linspace_numba-122"><a href="#linspace_numba-122"><span class="linenos">122</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Generate <code>num</code> evenly spaced values between <code>start</code> and <code>stop</code> for LOS sampling.</p>

<p>Parameters:</p>

<ul>
<li>start: The starting value of the sequence (float32).</li>
<li>stop: The end value of the sequence (float32).</li>
<li>num: Number of samples to generate, must be &gt;= 1 (int64).</li>
</ul>

<p>Returns:</p>

<ul>
<li>result: Array of <code>num</code> evenly spaced values in float32 format (float32[:]).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Optimized with Numba for performance in iterative computations.</li>
<li>Handles edge case where <code>num == 1</code> by setting step to 0.</li>
</ul>
</div>


                </section>
                <section id="delta_h">
                            <input id="delta_h-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-jit">@jit(float32[:](float32, float32, float32, float32[:]), nopython=True, cache=True)</div>

        <span class="def">def</span>
        <span class="name">delta_h</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">Re</span>, </span><span class="param"><span class="n">Rr</span>, </span><span class="param"><span class="n">dist_tot</span>, </span><span class="param"><span class="n">dists</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="delta_h-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#delta_h"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="delta_h-125"><a href="#delta_h-125"><span class="linenos">125</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">float32</span><span class="p">[:](</span><span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float32</span><span class="p">[:]),</span> <span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="delta_h-126"><a href="#delta_h-126"><span class="linenos">126</span></a><span class="k">def</span><span class="w"> </span><span class="nf">delta_h</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">Rr</span><span class="p">,</span> <span class="n">dist_tot</span><span class="p">,</span> <span class="n">dists</span><span class="p">):</span>
</span><span id="delta_h-127"><a href="#delta_h-127"><span class="linenos">127</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="delta_h-128"><a href="#delta_h-128"><span class="linenos">128</span></a><span class="sd">    Compute height adjustments (delta_h) for LOS calculations, accounting for Earth&#39;s curvature and atmospheric refraction.</span>
</span><span id="delta_h-129"><a href="#delta_h-129"><span class="linenos">129</span></a><span class="sd">    </span>
</span><span id="delta_h-130"><a href="#delta_h-130"><span class="linenos">130</span></a><span class="sd">    Parameters:</span>
</span><span id="delta_h-131"><a href="#delta_h-131"><span class="linenos">131</span></a><span class="sd">    - Re: Earth&#39;s radius in meters (float32).</span>
</span><span id="delta_h-132"><a href="#delta_h-132"><span class="linenos">132</span></a><span class="sd">    - Rr: Radio radius adjusted for atmospheric refraction, typically 4/3 * Re (float32).</span>
</span><span id="delta_h-133"><a href="#delta_h-133"><span class="linenos">133</span></a><span class="sd">    - dist_tot: Total distance between origin and target points in meters (float32).</span>
</span><span id="delta_h-134"><a href="#delta_h-134"><span class="linenos">134</span></a><span class="sd">    - dists: Array of distances along the LOS for each sampled point (float32[:]).</span>
</span><span id="delta_h-135"><a href="#delta_h-135"><span class="linenos">135</span></a><span class="sd">    </span>
</span><span id="delta_h-136"><a href="#delta_h-136"><span class="linenos">136</span></a><span class="sd">    Returns:</span>
</span><span id="delta_h-137"><a href="#delta_h-137"><span class="linenos">137</span></a><span class="sd">    - dh: Array of height adjustments in meters for each sampled point (float32[:]).</span>
</span><span id="delta_h-138"><a href="#delta_h-138"><span class="linenos">138</span></a><span class="sd">    </span>
</span><span id="delta_h-139"><a href="#delta_h-139"><span class="linenos">139</span></a><span class="sd">    Notes:</span>
</span><span id="delta_h-140"><a href="#delta_h-140"><span class="linenos">140</span></a><span class="sd">    - Uses a parabolic model to approximate the height offset due to curvature and refraction.</span>
</span><span id="delta_h-141"><a href="#delta_h-141"><span class="linenos">141</span></a><span class="sd">    - If `dist_tot &lt;= 0`, returns an array of zeros to avoid division by zero.</span>
</span><span id="delta_h-142"><a href="#delta_h-142"><span class="linenos">142</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="delta_h-143"><a href="#delta_h-143"><span class="linenos">143</span></a>    <span class="n">dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dists</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="delta_h-144"><a href="#delta_h-144"><span class="linenos">144</span></a>    <span class="k">if</span> <span class="n">dist_tot</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
</span><span id="delta_h-145"><a href="#delta_h-145"><span class="linenos">145</span></a>        <span class="n">dh</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>  <span class="c1"># No adjustment needed for zero or negative distance</span>
</span><span id="delta_h-146"><a href="#delta_h-146"><span class="linenos">146</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="delta_h-147"><a href="#delta_h-147"><span class="linenos">147</span></a>        <span class="c1"># Compute central height offset (do) due to curvature and refraction</span>
</span><span id="delta_h-148"><a href="#delta_h-148"><span class="linenos">148</span></a>        <span class="n">do</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Rr</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">dist_tot</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Re</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">dist_tot</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="delta_h-149"><a href="#delta_h-149"><span class="linenos">149</span></a>        <span class="n">dhc</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">+</span> <span class="n">do</span> <span class="o">-</span> <span class="n">Rr</span>  <span class="c1"># Central height correction</span>
</span><span id="delta_h-150"><a href="#delta_h-150"><span class="linenos">150</span></a>        <span class="c1"># Apply parabolic height adjustment based on distance</span>
</span><span id="delta_h-151"><a href="#delta_h-151"><span class="linenos">151</span></a>        <span class="n">dh</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">dhc</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist_tot</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dists</span> <span class="o">*</span> <span class="p">(</span><span class="n">dist_tot</span> <span class="o">-</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="delta_h-152"><a href="#delta_h-152"><span class="linenos">152</span></a>    <span class="k">return</span> <span class="n">dh</span>
</span></pre></div>


            <div class="docstring"><p>Compute height adjustments (delta_h) for LOS calculations, accounting for Earth's curvature and atmospheric refraction.</p>

<p>Parameters:</p>

<ul>
<li>Re: Earth's radius in meters (float32).</li>
<li>Rr: Radio radius adjusted for atmospheric refraction, typically 4/3 * Re (float32).</li>
<li>dist_tot: Total distance between origin and target points in meters (float32).</li>
<li>dists: Array of distances along the LOS for each sampled point (float32[:]).</li>
</ul>

<p>Returns:</p>

<ul>
<li>dh: Array of height adjustments in meters for each sampled point (float32[:]).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Uses a parabolic model to approximate the height offset due to curvature and refraction.</li>
<li>If <code>dist_tot &lt;= 0</code>, returns an array of zeros to avoid division by zero.</li>
</ul>
</div>


                </section>
                <section id="compute_los_core">
                            <input id="compute_los_core-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-jit">@jit(nopython=True, cache=True)</div>

        <span class="def">def</span>
        <span class="name">compute_los_core</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x0</span>, </span><span class="param"><span class="n">y0</span>, </span><span class="param"><span class="n">z0</span>, </span><span class="param"><span class="n">xs1</span>, </span><span class="param"><span class="n">ys1</span>, </span><span class="param"><span class="n">zs1</span>, </span><span class="param"><span class="n">resolution_m</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="compute_los_core-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#compute_los_core"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="compute_los_core-155"><a href="#compute_los_core-155"><span class="linenos">155</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="compute_los_core-156"><a href="#compute_los_core-156"><span class="linenos">156</span></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_los_core</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">zs1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="p">):</span>
</span><span id="compute_los_core-157"><a href="#compute_los_core-157"><span class="linenos">157</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="compute_los_core-158"><a href="#compute_los_core-158"><span class="linenos">158</span></a><span class="sd">    Compute sampled Cartesian coordinates along the LOS from an origin to multiple target points.</span>
</span><span id="compute_los_core-159"><a href="#compute_los_core-159"><span class="linenos">159</span></a><span class="sd">    </span>
</span><span id="compute_los_core-160"><a href="#compute_los_core-160"><span class="linenos">160</span></a><span class="sd">    Parameters:</span>
</span><span id="compute_los_core-161"><a href="#compute_los_core-161"><span class="linenos">161</span></a><span class="sd">    - x0, y0, z0: X, Y, Z-coordinates of the origin point in meters (float32).</span>
</span><span id="compute_los_core-162"><a href="#compute_los_core-162"><span class="linenos">162</span></a><span class="sd">    - xs1, ys1, zs1: X, Y, Z-coordinates of the target points in meters (float32[:]).</span>
</span><span id="compute_los_core-163"><a href="#compute_los_core-163"><span class="linenos">163</span></a><span class="sd">    - resolution_m: Sampling resolution along the LOS in meters (float32).</span>
</span><span id="compute_los_core-164"><a href="#compute_los_core-164"><span class="linenos">164</span></a><span class="sd">    </span>
</span><span id="compute_los_core-165"><a href="#compute_los_core-165"><span class="linenos">165</span></a><span class="sd">    Returns:</span>
</span><span id="compute_los_core-166"><a href="#compute_los_core-166"><span class="linenos">166</span></a><span class="sd">    - xs_samples: List of sampled X-coordinates for each LOS (Numba_List).</span>
</span><span id="compute_los_core-167"><a href="#compute_los_core-167"><span class="linenos">167</span></a><span class="sd">    - ys_samples: List of sampled Y-coordinates for each LOS (Numba_List).</span>
</span><span id="compute_los_core-168"><a href="#compute_los_core-168"><span class="linenos">168</span></a><span class="sd">    - zs_samples: List of sampled Z-coordinates for each LOS (Numba_List).</span>
</span><span id="compute_los_core-169"><a href="#compute_los_core-169"><span class="linenos">169</span></a><span class="sd">    - dists_tot: Total Euclidean distances from origin to each target (float32[:]).</span>
</span><span id="compute_los_core-170"><a href="#compute_los_core-170"><span class="linenos">170</span></a><span class="sd">    </span>
</span><span id="compute_los_core-171"><a href="#compute_los_core-171"><span class="linenos">171</span></a><span class="sd">    Notes:</span>
</span><span id="compute_los_core-172"><a href="#compute_los_core-172"><span class="linenos">172</span></a><span class="sd">    - Uses `linspace_numba` to generate evenly spaced samples along each LOS.</span>
</span><span id="compute_los_core-173"><a href="#compute_los_core-173"><span class="linenos">173</span></a><span class="sd">    - Number of samples is determined based on total distance and resolution.</span>
</span><span id="compute_los_core-174"><a href="#compute_los_core-174"><span class="linenos">174</span></a><span class="sd">    - Parallelized with Numba&#39;s `prange` for performance with multiple targets.</span>
</span><span id="compute_los_core-175"><a href="#compute_los_core-175"><span class="linenos">175</span></a><span class="sd">    - Type signature omitted due to `Numba_List` complexity; relies on Numba&#39;s type inference.</span>
</span><span id="compute_los_core-176"><a href="#compute_los_core-176"><span class="linenos">176</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="compute_los_core-177"><a href="#compute_los_core-177"><span class="linenos">177</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs1</span><span class="p">)</span>
</span><span id="compute_los_core-178"><a href="#compute_los_core-178"><span class="linenos">178</span></a>    <span class="c1"># Calculate total Euclidean distances from origin to each target</span>
</span><span id="compute_los_core-179"><a href="#compute_los_core-179"><span class="linenos">179</span></a>    <span class="n">dists_tot</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xs1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ys1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zs1</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="compute_los_core-180"><a href="#compute_los_core-180"><span class="linenos">180</span></a>    <span class="c1"># Determine number of samples based on resolution (at least 2 samples)</span>
</span><span id="compute_los_core-181"><a href="#compute_los_core-181"><span class="linenos">181</span></a>    <span class="n">ns_samples</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dists_tot</span> <span class="o">/</span> <span class="n">resolution_m</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
</span><span id="compute_los_core-182"><a href="#compute_los_core-182"><span class="linenos">182</span></a>    
</span><span id="compute_los_core-183"><a href="#compute_los_core-183"><span class="linenos">183</span></a>    <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span> <span class="o">=</span> <span class="n">Numba_List</span><span class="p">(),</span> <span class="n">Numba_List</span><span class="p">(),</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="compute_los_core-184"><a href="#compute_los_core-184"><span class="linenos">184</span></a>    <span class="n">v_dummy</span> <span class="o">=</span> <span class="n">linspace_numba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="compute_los_core-185"><a href="#compute_los_core-185"><span class="linenos">185</span></a>
</span><span id="compute_los_core-186"><a href="#compute_los_core-186"><span class="linenos">186</span></a>    <span class="c1"># Initialize numba lists with dummy vector, parallel mode must not be used</span>
</span><span id="compute_los_core-187"><a href="#compute_los_core-187"><span class="linenos">187</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="compute_los_core-188"><a href="#compute_los_core-188"><span class="linenos">188</span></a>        <span class="c1"># Generate sampled coordinates for each LOS</span>
</span><span id="compute_los_core-189"><a href="#compute_los_core-189"><span class="linenos">189</span></a>        <span class="n">xs_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linspace_numba</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ns_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="compute_los_core-190"><a href="#compute_los_core-190"><span class="linenos">190</span></a>        <span class="n">ys_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linspace_numba</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">ys1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ns_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="compute_los_core-191"><a href="#compute_los_core-191"><span class="linenos">191</span></a>        <span class="n">zs_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linspace_numba</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">zs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ns_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="compute_los_core-192"><a href="#compute_los_core-192"><span class="linenos">192</span></a>    
</span><span id="compute_los_core-193"><a href="#compute_los_core-193"><span class="linenos">193</span></a>    <span class="k">return</span> <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span>
</span></pre></div>


            <div class="docstring"><p>Compute sampled Cartesian coordinates along the LOS from an origin to multiple target points.</p>

<p>Parameters:</p>

<ul>
<li>x0, y0, z0: X, Y, Z-coordinates of the origin point in meters (float32).</li>
<li>xs1, ys1, zs1: X, Y, Z-coordinates of the target points in meters (float32[:]).</li>
<li>resolution_m: Sampling resolution along the LOS in meters (float32).</li>
</ul>

<p>Returns:</p>

<ul>
<li>xs_samples: List of sampled X-coordinates for each LOS (Numba_List).</li>
<li>ys_samples: List of sampled Y-coordinates for each LOS (Numba_List).</li>
<li>zs_samples: List of sampled Z-coordinates for each LOS (Numba_List).</li>
<li>dists_tot: Total Euclidean distances from origin to each target (float32[:]).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Uses <code><a href="#linspace_numba">linspace_numba</a></code> to generate evenly spaced samples along each LOS.</li>
<li>Number of samples is determined based on total distance and resolution.</li>
<li>Parallelized with Numba's <code>prange</code> for performance with multiple targets.</li>
<li>Type signature omitted due to <code>Numba_List</code> complexity; relies on Numba's type inference.</li>
</ul>
</div>


                </section>
                <section id="compute_los">
                            <input id="compute_los-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-jit">@jit(nopython=True, cache=True)</div>

        <span class="def">def</span>
        <span class="name">compute_los</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">tiles_1d_array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">tiles_indices</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">tiles_nrows</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">tiles_ncols</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">lng0</span>,</span><span class="param">	<span class="n">lat0</span>,</span><span class="param">	<span class="n">alt0</span>,</span><span class="param">	<span class="n">lngs1</span>,</span><span class="param">	<span class="n">lats1</span>,</span><span class="param">	<span class="n">alts1</span>,</span><span class="param">	<span class="n">resolution_m</span><span class="o">=</span><span class="mf">400.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="compute_los-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#compute_los"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="compute_los-196"><a href="#compute_los-196"><span class="linenos">196</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="compute_los-197"><a href="#compute_los-197"><span class="linenos">197</span></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_los</span><span class="p">(</span><span class="n">tiles_1d_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tiles_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="compute_los-198"><a href="#compute_los-198"><span class="linenos">198</span></a>                <span class="n">tiles_nrows</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tiles_ncols</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="compute_los-199"><a href="#compute_los-199"><span class="linenos">199</span></a>                <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="o">=</span><span class="mf">400.</span><span class="p">):</span>
</span><span id="compute_los-200"><a href="#compute_los-200"><span class="linenos">200</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="compute_los-201"><a href="#compute_los-201"><span class="linenos">201</span></a><span class="sd">    Compute the LOS in geographic coordinates and retrieve terrain altitudes from the DTM.</span>
</span><span id="compute_los-202"><a href="#compute_los-202"><span class="linenos">202</span></a><span class="sd">    </span>
</span><span id="compute_los-203"><a href="#compute_los-203"><span class="linenos">203</span></a><span class="sd">    Parameters:</span>
</span><span id="compute_los-204"><a href="#compute_los-204"><span class="linenos">204</span></a><span class="sd">    - tiles_1d_array, tiles_indices, tiles_nrows, tiles_ncols: DTM arrays for accessing terrain data.</span>
</span><span id="compute_los-205"><a href="#compute_los-205"><span class="linenos">205</span></a><span class="sd">    - lng0: Longitude of the origin point in degrees (float).</span>
</span><span id="compute_los-206"><a href="#compute_los-206"><span class="linenos">206</span></a><span class="sd">    - lat0: Latitude of the origin point in degrees (float).</span>
</span><span id="compute_los-207"><a href="#compute_los-207"><span class="linenos">207</span></a><span class="sd">    - alt0: Altitude of the origin point in meters (float).</span>
</span><span id="compute_los-208"><a href="#compute_los-208"><span class="linenos">208</span></a><span class="sd">    - lngs1: Longitudes of the target points in degrees (np.array).</span>
</span><span id="compute_los-209"><a href="#compute_los-209"><span class="linenos">209</span></a><span class="sd">    - lats1: Latitudes of the target points in degrees (np.array).</span>
</span><span id="compute_los-210"><a href="#compute_los-210"><span class="linenos">210</span></a><span class="sd">    - alts1: Altitudes of the target points in meters (np.array).</span>
</span><span id="compute_los-211"><a href="#compute_los-211"><span class="linenos">211</span></a><span class="sd">    - resolution_m: Sampling resolution along the LOS in meters, default 400 (float).</span>
</span><span id="compute_los-212"><a href="#compute_los-212"><span class="linenos">212</span></a><span class="sd">    </span>
</span><span id="compute_los-213"><a href="#compute_los-213"><span class="linenos">213</span></a><span class="sd">    Returns:</span>
</span><span id="compute_los-214"><a href="#compute_los-214"><span class="linenos">214</span></a><span class="sd">    - lngss: Lists of sampled longitudes along each LOS (Numba_List).</span>
</span><span id="compute_los-215"><a href="#compute_los-215"><span class="linenos">215</span></a><span class="sd">    - latss: Lists of sampled latitudes along each LOS (Numba_List).</span>
</span><span id="compute_los-216"><a href="#compute_los-216"><span class="linenos">216</span></a><span class="sd">    - altss_los: Lists of sampled altitudes along each LOS (Numba_List).</span>
</span><span id="compute_los-217"><a href="#compute_los-217"><span class="linenos">217</span></a><span class="sd">    - altss_relief: Lists of terrain altitudes from the DTM for each LOS (Numba_List).</span>
</span><span id="compute_los-218"><a href="#compute_los-218"><span class="linenos">218</span></a><span class="sd">    - xs_samples: Lists of sampled X-coordinates in Cartesian (Numba_List).</span>
</span><span id="compute_los-219"><a href="#compute_los-219"><span class="linenos">219</span></a><span class="sd">    - ys_samples: Lists of sampled Y-coordinates in Cartesian (Numba_List).</span>
</span><span id="compute_los-220"><a href="#compute_los-220"><span class="linenos">220</span></a><span class="sd">    - zs_samples: Lists of sampled Z-coordinates in Cartesian (Numba_List).</span>
</span><span id="compute_los-221"><a href="#compute_los-221"><span class="linenos">221</span></a><span class="sd">    - dists_tot: Total distances from origin to each target (np.array).</span>
</span><span id="compute_los-222"><a href="#compute_los-222"><span class="linenos">222</span></a><span class="sd">    </span>
</span><span id="compute_los-223"><a href="#compute_los-223"><span class="linenos">223</span></a><span class="sd">    Notes:</span>
</span><span id="compute_los-224"><a href="#compute_los-224"><span class="linenos">224</span></a><span class="sd">    - Converts geographic coordinates to Cartesian for LOS computation, then back to geographic for DTM queries.</span>
</span><span id="compute_los-225"><a href="#compute_los-225"><span class="linenos">225</span></a><span class="sd">    - Uses shared memory to efficiently retrieve terrain altitudes.</span>
</span><span id="compute_los-226"><a href="#compute_los-226"><span class="linenos">226</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="compute_los-227"><a href="#compute_los-227"><span class="linenos">227</span></a>    <span class="c1"># Convert origin and target points to Cartesian coordinates</span>
</span><span id="compute_los-228"><a href="#compute_los-228"><span class="linenos">228</span></a>    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span>     <span class="o">=</span> <span class="n">geo_to_cart</span><span class="p">(</span><span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">)</span>
</span><span id="compute_los-229"><a href="#compute_los-229"><span class="linenos">229</span></a>    <span class="n">xs1</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">zs1</span>  <span class="o">=</span> <span class="n">geo_to_cart</span><span class="p">(</span><span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">)</span>
</span><span id="compute_los-230"><a href="#compute_los-230"><span class="linenos">230</span></a>
</span><span id="compute_los-231"><a href="#compute_los-231"><span class="linenos">231</span></a>    <span class="c1"># Compute sampled Cartesian coordinates along the LOS</span>
</span><span id="compute_los-232"><a href="#compute_los-232"><span class="linenos">232</span></a>    <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span> <span class="o">=</span> <span class="n">compute_los_core</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">xs1</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">zs1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="p">)</span>
</span><span id="compute_los-233"><a href="#compute_los-233"><span class="linenos">233</span></a>
</span><span id="compute_los-234"><a href="#compute_los-234"><span class="linenos">234</span></a>    <span class="c1"># Initialize lists for geographic coordinates and terrain altitudes</span>
</span><span id="compute_los-235"><a href="#compute_los-235"><span class="linenos">235</span></a>    <span class="n">lngss</span>        <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="compute_los-236"><a href="#compute_los-236"><span class="linenos">236</span></a>    <span class="n">latss</span>        <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="compute_los-237"><a href="#compute_los-237"><span class="linenos">237</span></a>    <span class="n">altss_los</span>    <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="compute_los-238"><a href="#compute_los-238"><span class="linenos">238</span></a>    <span class="n">altss_relief</span> <span class="o">=</span> <span class="n">Numba_List</span><span class="p">()</span>
</span><span id="compute_los-239"><a href="#compute_los-239"><span class="linenos">239</span></a>    
</span><span id="compute_los-240"><a href="#compute_los-240"><span class="linenos">240</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="compute_los-241"><a href="#compute_los-241"><span class="linenos">241</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">)):</span>
</span><span id="compute_los-242"><a href="#compute_los-242"><span class="linenos">242</span></a>            <span class="c1"># Convert sampled Cartesian coordinates back to geographic</span>
</span><span id="compute_los-243"><a href="#compute_los-243"><span class="linenos">243</span></a>            <span class="n">lngs</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">alts</span> <span class="o">=</span> <span class="n">cart_to_geo</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ys_samples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="compute_los-244"><a href="#compute_los-244"><span class="linenos">244</span></a>            <span class="n">lngss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lngs</span><span class="p">)</span>
</span><span id="compute_los-245"><a href="#compute_los-245"><span class="linenos">245</span></a>            <span class="n">latss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>
</span><span id="compute_los-246"><a href="#compute_los-246"><span class="linenos">246</span></a>            <span class="n">altss_los</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alts</span><span class="p">)</span>
</span><span id="compute_los-247"><a href="#compute_los-247"><span class="linenos">247</span></a>            <span class="c1"># Retrieve terrain altitudes from DTM for the sampled points</span>
</span><span id="compute_los-248"><a href="#compute_los-248"><span class="linenos">248</span></a>            <span class="n">altss_relief</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_altitudes_vect_nb</span><span class="p">(</span><span class="n">tiles_1d_array</span><span class="p">,</span> <span class="n">tiles_indices</span><span class="p">,</span>
</span><span id="compute_los-249"><a href="#compute_los-249"><span class="linenos">249</span></a>                                                      <span class="n">tiles_nrows</span><span class="p">,</span> <span class="n">tiles_ncols</span><span class="p">,</span>
</span><span id="compute_los-250"><a href="#compute_los-250"><span class="linenos">250</span></a>                                                      <span class="n">lngs</span><span class="p">,</span> <span class="n">lats</span><span class="p">))</span>
</span><span id="compute_los-251"><a href="#compute_los-251"><span class="linenos">251</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="compute_los-252"><a href="#compute_los-252"><span class="linenos">252</span></a>        <span class="c1"># Force type of the numba list which is empty ! </span>
</span><span id="compute_los-253"><a href="#compute_los-253"><span class="linenos">253</span></a>        <span class="n">dummy_array_float32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="compute_los-254"><a href="#compute_los-254"><span class="linenos">254</span></a>        <span class="n">lngss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_float32</span><span class="p">)</span>
</span><span id="compute_los-255"><a href="#compute_los-255"><span class="linenos">255</span></a>        <span class="n">lngss</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="compute_los-256"><a href="#compute_los-256"><span class="linenos">256</span></a>        <span class="n">latss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_float32</span><span class="p">)</span>
</span><span id="compute_los-257"><a href="#compute_los-257"><span class="linenos">257</span></a>        <span class="n">latss</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="compute_los-258"><a href="#compute_los-258"><span class="linenos">258</span></a>        <span class="n">altss_los</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_float32</span><span class="p">)</span>
</span><span id="compute_los-259"><a href="#compute_los-259"><span class="linenos">259</span></a>        <span class="n">altss_los</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="compute_los-260"><a href="#compute_los-260"><span class="linenos">260</span></a>
</span><span id="compute_los-261"><a href="#compute_los-261"><span class="linenos">261</span></a>        <span class="n">dummy_array_uint16</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="compute_los-262"><a href="#compute_los-262"><span class="linenos">262</span></a>        <span class="n">altss_relief</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_array_uint16</span><span class="p">)</span>
</span><span id="compute_los-263"><a href="#compute_los-263"><span class="linenos">263</span></a>        <span class="n">altss_relief</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="compute_los-264"><a href="#compute_los-264"><span class="linenos">264</span></a>    
</span><span id="compute_los-265"><a href="#compute_los-265"><span class="linenos">265</span></a>    <span class="k">return</span> <span class="n">lngss</span><span class="p">,</span> <span class="n">latss</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span>
</span></pre></div>


            <div class="docstring"><p>Compute the LOS in geographic coordinates and retrieve terrain altitudes from the DTM.</p>

<p>Parameters:</p>

<ul>
<li>tiles_1d_array, tiles_indices, tiles_nrows, tiles_ncols: DTM arrays for accessing terrain data.</li>
<li>lng0: Longitude of the origin point in degrees (float).</li>
<li>lat0: Latitude of the origin point in degrees (float).</li>
<li>alt0: Altitude of the origin point in meters (float).</li>
<li>lngs1: Longitudes of the target points in degrees (np.array).</li>
<li>lats1: Latitudes of the target points in degrees (np.array).</li>
<li>alts1: Altitudes of the target points in meters (np.array).</li>
<li>resolution_m: Sampling resolution along the LOS in meters, default 400 (float).</li>
</ul>

<p>Returns:</p>

<ul>
<li>lngss: Lists of sampled longitudes along each LOS (Numba_List).</li>
<li>latss: Lists of sampled latitudes along each LOS (Numba_List).</li>
<li>altss_los: Lists of sampled altitudes along each LOS (Numba_List).</li>
<li>altss_relief: Lists of terrain altitudes from the DTM for each LOS (Numba_List).</li>
<li>xs_samples: Lists of sampled X-coordinates in Cartesian (Numba_List).</li>
<li>ys_samples: Lists of sampled Y-coordinates in Cartesian (Numba_List).</li>
<li>zs_samples: Lists of sampled Z-coordinates in Cartesian (Numba_List).</li>
<li>dists_tot: Total distances from origin to each target (np.array).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Converts geographic coordinates to Cartesian for LOS computation, then back to geographic for DTM queries.</li>
<li>Uses shared memory to efficiently retrieve terrain altitudes.</li>
</ul>
</div>


                </section>
                <section id="are_intervisible_core">
                            <input id="are_intervisible_core-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-jit">@jit(nopython=True, parallel=True, cache=True)</div>

        <span class="def">def</span>
        <span class="name">are_intervisible_core</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">xs_samples</span><span class="p">:</span> <span class="n">ListType</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="mi">1</span><span class="n">d</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>,</span><span class="param">	<span class="n">ys_samples</span><span class="p">:</span> <span class="n">ListType</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="mi">1</span><span class="n">d</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>,</span><span class="param">	<span class="n">zs_samples</span><span class="p">:</span> <span class="n">ListType</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="mi">1</span><span class="n">d</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>,</span><span class="param">	<span class="n">altss_los</span><span class="p">:</span> <span class="n">ListType</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="mi">1</span><span class="n">d</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>,</span><span class="param">	<span class="n">altss_relief</span><span class="p">:</span> <span class="n">ListType</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="mi">1</span><span class="n">d</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>,</span><span class="param">	<span class="n">R</span><span class="p">:</span> <span class="n">float32</span>,</span><span class="param">	<span class="n">dists_tot</span><span class="p">:</span> <span class="n">Array</span><span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">aligned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span><span class="return-annotation">) -> <span class="n">Array</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">aligned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>:</span></span>

                <label class="view-source-button" for="are_intervisible_core-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#are_intervisible_core"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="are_intervisible_core-268"><a href="#are_intervisible_core-268"><span class="linenos">268</span></a><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="are_intervisible_core-269"><a href="#are_intervisible_core-269"><span class="linenos">269</span></a><span class="k">def</span><span class="w"> </span><span class="nf">are_intervisible_core</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">ys_samples</span>  <span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span>
</span><span id="are_intervisible_core-270"><a href="#are_intervisible_core-270"><span class="linenos">270</span></a>                          <span class="n">altss_los</span> <span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">:</span> <span class="n">list_float32_array</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">float32</span><span class="p">,</span> <span class="n">dists_tot</span><span class="p">:</span> <span class="n">float32</span><span class="p">[:])</span> <span class="o">-&gt;</span> <span class="n">bool_</span><span class="p">[:]:</span>
</span><span id="are_intervisible_core-271"><a href="#are_intervisible_core-271"><span class="linenos">271</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="are_intervisible_core-272"><a href="#are_intervisible_core-272"><span class="linenos">272</span></a><span class="sd">    Determine if target points are intervisible from the origin, considering terrain and geophysical effects.</span>
</span><span id="are_intervisible_core-273"><a href="#are_intervisible_core-273"><span class="linenos">273</span></a><span class="sd">    </span>
</span><span id="are_intervisible_core-274"><a href="#are_intervisible_core-274"><span class="linenos">274</span></a><span class="sd">    Parameters:</span>
</span><span id="are_intervisible_core-275"><a href="#are_intervisible_core-275"><span class="linenos">275</span></a><span class="sd">    - xs_samples: Lists of sampled X-coordinates along each LOS (Numba_List).</span>
</span><span id="are_intervisible_core-276"><a href="#are_intervisible_core-276"><span class="linenos">276</span></a><span class="sd">    - ys_samples: Lists of sampled Y-coordinates along each LOS (Numba_List).</span>
</span><span id="are_intervisible_core-277"><a href="#are_intervisible_core-277"><span class="linenos">277</span></a><span class="sd">    - zs_samples: Lists of sampled Z-coordinates along each LOS (Numba_List).</span>
</span><span id="are_intervisible_core-278"><a href="#are_intervisible_core-278"><span class="linenos">278</span></a><span class="sd">    - altss_los : Lists of altitudes along each LOS (Numba_List).</span>
</span><span id="are_intervisible_core-279"><a href="#are_intervisible_core-279"><span class="linenos">279</span></a><span class="sd">    - altss_relief: Lists of terrain altitudes from the DTM (Numba_List).</span>
</span><span id="are_intervisible_core-280"><a href="#are_intervisible_core-280"><span class="linenos">280</span></a><span class="sd">    - R: Radius adjusted for refraction in meters (float32).</span>
</span><span id="are_intervisible_core-281"><a href="#are_intervisible_core-281"><span class="linenos">281</span></a><span class="sd">    - dists_tot: Total distances from origin to each target in meters (float32[:]).</span>
</span><span id="are_intervisible_core-282"><a href="#are_intervisible_core-282"><span class="linenos">282</span></a><span class="sd">    </span>
</span><span id="are_intervisible_core-283"><a href="#are_intervisible_core-283"><span class="linenos">283</span></a><span class="sd">    Returns:</span>
</span><span id="are_intervisible_core-284"><a href="#are_intervisible_core-284"><span class="linenos">284</span></a><span class="sd">    - result: Boolean array indicating intervisibility, True if visible (bool_[:]).</span>
</span><span id="are_intervisible_core-285"><a href="#are_intervisible_core-285"><span class="linenos">285</span></a><span class="sd">    </span>
</span><span id="are_intervisible_core-286"><a href="#are_intervisible_core-286"><span class="linenos">286</span></a><span class="sd">    Notes:</span>
</span><span id="are_intervisible_core-287"><a href="#are_intervisible_core-287"><span class="linenos">287</span></a><span class="sd">    - Adjusts LOS altitudes with `delta_h` to account for Earth&#39;s curvature and refraction.</span>
</span><span id="are_intervisible_core-288"><a href="#are_intervisible_core-288"><span class="linenos">288</span></a><span class="sd">    - Checks if any terrain altitude exceeds the adjusted LOS altitude, indicating an obstruction.</span>
</span><span id="are_intervisible_core-289"><a href="#are_intervisible_core-289"><span class="linenos">289</span></a><span class="sd">    - Parallelized with Numba&#39;s `prange` for performance with multiple targets.</span>
</span><span id="are_intervisible_core-290"><a href="#are_intervisible_core-290"><span class="linenos">290</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="are_intervisible_core-291"><a href="#are_intervisible_core-291"><span class="linenos">291</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs_samples</span><span class="p">))</span>
</span><span id="are_intervisible_core-292"><a href="#are_intervisible_core-292"><span class="linenos">292</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
</span><span id="are_intervisible_core-293"><a href="#are_intervisible_core-293"><span class="linenos">293</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="are_intervisible_core-294"><a href="#are_intervisible_core-294"><span class="linenos">294</span></a>        <span class="c1"># Calculate distances along the LOS from the origin</span>
</span><span id="are_intervisible_core-295"><a href="#are_intervisible_core-295"><span class="linenos">295</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
</span><span id="are_intervisible_core-296"><a href="#are_intervisible_core-296"><span class="linenos">296</span></a>                        <span class="p">(</span><span class="n">ys_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ys_samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
</span><span id="are_intervisible_core-297"><a href="#are_intervisible_core-297"><span class="linenos">297</span></a>                        <span class="p">(</span><span class="n">zs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">zs_samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="are_intervisible_core-298"><a href="#are_intervisible_core-298"><span class="linenos">298</span></a>        <span class="c1"># Compute height adjustments for curvature and refraction</span>
</span><span id="are_intervisible_core-299"><a href="#are_intervisible_core-299"><span class="linenos">299</span></a>        <span class="n">dh</span> <span class="o">=</span> <span class="n">delta_h</span><span class="p">(</span><span class="n">R_EARTH</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">dists_tot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="are_intervisible_core-300"><a href="#are_intervisible_core-300"><span class="linenos">300</span></a>        <span class="c1"># Adjust LOS altitudes and compare with terrain altitudes</span>
</span><span id="are_intervisible_core-301"><a href="#are_intervisible_core-301"><span class="linenos">301</span></a>        <span class="n">alts_adj</span> <span class="o">=</span> <span class="n">altss_los</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dh</span>
</span><span id="are_intervisible_core-302"><a href="#are_intervisible_core-302"><span class="linenos">302</span></a>        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">altss_relief</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">alts_adj</span><span class="p">)</span>  <span class="c1"># True if no terrain exceeds adjusted LOS</span>
</span><span id="are_intervisible_core-303"><a href="#are_intervisible_core-303"><span class="linenos">303</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Determine if target points are intervisible from the origin, considering terrain and geophysical effects.</p>

<p>Parameters:</p>

<ul>
<li>xs_samples: Lists of sampled X-coordinates along each LOS (Numba_List).</li>
<li>ys_samples: Lists of sampled Y-coordinates along each LOS (Numba_List).</li>
<li>zs_samples: Lists of sampled Z-coordinates along each LOS (Numba_List).</li>
<li>altss_los : Lists of altitudes along each LOS (Numba_List).</li>
<li>altss_relief: Lists of terrain altitudes from the DTM (Numba_List).</li>
<li>R: Radius adjusted for refraction in meters (float32).</li>
<li>dists_tot: Total distances from origin to each target in meters (float32[:]).</li>
</ul>

<p>Returns:</p>

<ul>
<li>result: Boolean array indicating intervisibility, True if visible (bool_[:]).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Adjusts LOS altitudes with <code><a href="#delta_h">delta_h</a></code> to account for Earth's curvature and refraction.</li>
<li>Checks if any terrain altitude exceeds the adjusted LOS altitude, indicating an obstruction.</li>
<li>Parallelized with Numba's <code>prange</code> for performance with multiple targets.</li>
</ul>
</div>


                </section>
                <section id="are_intervisible">
                            <input id="are_intervisible-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">are_intervisible</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shm_dtm_user</span>,</span><span class="param">	<span class="n">lng0</span>,</span><span class="param">	<span class="n">lat0</span>,</span><span class="param">	<span class="n">alt0</span>,</span><span class="param">	<span class="n">lngs1</span>,</span><span class="param">	<span class="n">lats1</span>,</span><span class="param">	<span class="n">alts1</span>,</span><span class="param">	<span class="n">resolution_m</span><span class="o">=</span><span class="mf">400.0</span>,</span><span class="param">	<span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">8494667.0</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="are_intervisible-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#are_intervisible"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="are_intervisible-306"><a href="#are_intervisible-306"><span class="linenos">306</span></a><span class="k">def</span><span class="w"> </span><span class="nf">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">):</span>
</span><span id="are_intervisible-307"><a href="#are_intervisible-307"><span class="linenos">307</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="are_intervisible-308"><a href="#are_intervisible-308"><span class="linenos">308</span></a><span class="sd">    Check if target points are intervisible from the origin point using the DTM.</span>
</span><span id="are_intervisible-309"><a href="#are_intervisible-309"><span class="linenos">309</span></a><span class="sd">    </span>
</span><span id="are_intervisible-310"><a href="#are_intervisible-310"><span class="linenos">310</span></a><span class="sd">    Parameters:</span>
</span><span id="are_intervisible-311"><a href="#are_intervisible-311"><span class="linenos">311</span></a><span class="sd">    - tiles_1d_array, tiles_indices, tiles_nrows, tiles_ncols: DTM arrays for terrain data access.</span>
</span><span id="are_intervisible-312"><a href="#are_intervisible-312"><span class="linenos">312</span></a><span class="sd">    - lng0: Longitude of the origin point in degrees (float).</span>
</span><span id="are_intervisible-313"><a href="#are_intervisible-313"><span class="linenos">313</span></a><span class="sd">    - lat0: Latitude of the origin point in degrees (float).</span>
</span><span id="are_intervisible-314"><a href="#are_intervisible-314"><span class="linenos">314</span></a><span class="sd">    - alt0: Altitude of the origin point in meters (float).</span>
</span><span id="are_intervisible-315"><a href="#are_intervisible-315"><span class="linenos">315</span></a><span class="sd">    - lngs1: Longitudes of the target points in degrees (np.array).</span>
</span><span id="are_intervisible-316"><a href="#are_intervisible-316"><span class="linenos">316</span></a><span class="sd">    - lats1: Latitudes of the target points in degrees (np.array).</span>
</span><span id="are_intervisible-317"><a href="#are_intervisible-317"><span class="linenos">317</span></a><span class="sd">    - alts1: Altitudes of the target points in meters (np.array).</span>
</span><span id="are_intervisible-318"><a href="#are_intervisible-318"><span class="linenos">318</span></a><span class="sd">    - resolution_m: Sampling resolution along the LOS in meters, default 400 (float).</span>
</span><span id="are_intervisible-319"><a href="#are_intervisible-319"><span class="linenos">319</span></a><span class="sd">    - R: Radius adjusted for refraction in meters, default R_RADIO (float32).</span>
</span><span id="are_intervisible-320"><a href="#are_intervisible-320"><span class="linenos">320</span></a><span class="sd">    </span>
</span><span id="are_intervisible-321"><a href="#are_intervisible-321"><span class="linenos">321</span></a><span class="sd">    Returns:</span>
</span><span id="are_intervisible-322"><a href="#are_intervisible-322"><span class="linenos">322</span></a><span class="sd">    - result: Boolean array indicating intervisibility for each target, True if visible (np.array).</span>
</span><span id="are_intervisible-323"><a href="#are_intervisible-323"><span class="linenos">323</span></a><span class="sd">    </span>
</span><span id="are_intervisible-324"><a href="#are_intervisible-324"><span class="linenos">324</span></a><span class="sd">    Notes:</span>
</span><span id="are_intervisible-325"><a href="#are_intervisible-325"><span class="linenos">325</span></a><span class="sd">    - Orchestrates LOS computation and intervisibility check by calling `compute_los` and `are_intervisible_core`.</span>
</span><span id="are_intervisible-326"><a href="#are_intervisible-326"><span class="linenos">326</span></a><span class="sd">    - Ensures efficient terrain data access via shared memory.</span>
</span><span id="are_intervisible-327"><a href="#are_intervisible-327"><span class="linenos">327</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="are_intervisible-328"><a href="#are_intervisible-328"><span class="linenos">328</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>  <span class="c1"># Ensure radius is float32 for consistency</span>
</span><span id="are_intervisible-329"><a href="#are_intervisible-329"><span class="linenos">329</span></a>
</span><span id="are_intervisible-330"><a href="#are_intervisible-330"><span class="linenos">330</span></a>    <span class="c1"># Compute horizon intervisibilities</span>
</span><span id="are_intervisible-331"><a href="#are_intervisible-331"><span class="linenos">331</span></a>    <span class="n">distances</span>           <span class="o">=</span> <span class="n">straight_line_distances</span><span class="p">(</span><span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">)</span>
</span><span id="are_intervisible-332"><a href="#are_intervisible-332"><span class="linenos">332</span></a>    <span class="n">intervisi_distances</span> <span class="o">=</span> <span class="n">horizon_intervisibility_distances</span><span class="p">(</span><span class="n">alt0</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>
</span><span id="are_intervisible-333"><a href="#are_intervisible-333"><span class="linenos">333</span></a>    <span class="c1">#logging.info((&#39;R, distances[0], intervisi_distances[0]&#39;, R, distances[0], intervisi_distances[0]))</span>
</span><span id="are_intervisible-334"><a href="#are_intervisible-334"><span class="linenos">334</span></a>    <span class="n">intervisibilities</span>   <span class="o">=</span> <span class="p">(</span><span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">intervisi_distances</span><span class="p">)</span>
</span><span id="are_intervisible-335"><a href="#are_intervisible-335"><span class="linenos">335</span></a>    
</span><span id="are_intervisible-336"><a href="#are_intervisible-336"><span class="linenos">336</span></a>    <span class="k">if</span> <span class="n">intervisibilities</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="are_intervisible-337"><a href="#are_intervisible-337"><span class="linenos">337</span></a>        <span class="n">intervisi_args</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">intervisibilities</span><span class="p">)</span>
</span><span id="are_intervisible-338"><a href="#are_intervisible-338"><span class="linenos">338</span></a>
</span><span id="are_intervisible-339"><a href="#are_intervisible-339"><span class="linenos">339</span></a>        <span class="c1"># Compute LOS samples and retrieve terrain altitudes</span>
</span><span id="are_intervisible-340"><a href="#are_intervisible-340"><span class="linenos">340</span></a>        <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span> <span class="o">=</span> <span class="n">lngs1</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">],</span> <span class="n">lats1</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">],</span> <span class="n">alts1</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">]</span>
</span><span id="are_intervisible-341"><a href="#are_intervisible-341"><span class="linenos">341</span></a>        <span class="n">lngss</span><span class="p">,</span> <span class="n">latss</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">dists</span> <span class="o">=</span> <span class="n">compute_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_1d_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_indices_array</span><span class="p">,</span>
</span><span id="are_intervisible-342"><a href="#are_intervisible-342"><span class="linenos">342</span></a>                                                                               <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_nrows_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_ncols_array</span><span class="p">,</span>
</span><span id="are_intervisible-343"><a href="#are_intervisible-343"><span class="linenos">343</span></a>                                                                               <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_m</span><span class="p">)</span>
</span><span id="are_intervisible-344"><a href="#are_intervisible-344"><span class="linenos">344</span></a>        
</span><span id="are_intervisible-345"><a href="#are_intervisible-345"><span class="linenos">345</span></a>        <span class="n">relief_intervisibilities</span> <span class="o">=</span> <span class="n">are_intervisible_core</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="are_intervisible-346"><a href="#are_intervisible-346"><span class="linenos">346</span></a>
</span><span id="are_intervisible-347"><a href="#are_intervisible-347"><span class="linenos">347</span></a>        <span class="n">intervisibilities</span><span class="p">[</span><span class="n">intervisi_args</span><span class="p">]</span> <span class="o">=</span> <span class="n">relief_intervisibilities</span>
</span><span id="are_intervisible-348"><a href="#are_intervisible-348"><span class="linenos">348</span></a>
</span><span id="are_intervisible-349"><a href="#are_intervisible-349"><span class="linenos">349</span></a>    <span class="k">return</span> <span class="n">intervisibilities</span>
</span></pre></div>


            <div class="docstring"><p>Check if target points are intervisible from the origin point using the DTM.</p>

<p>Parameters:</p>

<ul>
<li>tiles_1d_array, tiles_indices, tiles_nrows, tiles_ncols: DTM arrays for terrain data access.</li>
<li>lng0: Longitude of the origin point in degrees (float).</li>
<li>lat0: Latitude of the origin point in degrees (float).</li>
<li>alt0: Altitude of the origin point in meters (float).</li>
<li>lngs1: Longitudes of the target points in degrees (np.array).</li>
<li>lats1: Latitudes of the target points in degrees (np.array).</li>
<li>alts1: Altitudes of the target points in meters (np.array).</li>
<li>resolution_m: Sampling resolution along the LOS in meters, default 400 (float).</li>
<li>R: Radius adjusted for refraction in meters, default R_RADIO (float32).</li>
</ul>

<p>Returns:</p>

<ul>
<li>result: Boolean array indicating intervisibility for each target, True if visible (np.array).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Orchestrates LOS computation and intervisibility check by calling <code><a href="#compute_los">compute_los</a></code> and <code><a href="#are_intervisible_core">are_intervisible_core</a></code>.</li>
<li>Ensures efficient terrain data access via shared memory.</li>
</ul>
</div>


                </section>
                <section id="plot_los">
                            <input id="plot_los-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_los</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shm_dtm_user</span>,</span><span class="param">	<span class="n">lng0</span>,</span><span class="param">	<span class="n">lat0</span>,</span><span class="param">	<span class="n">alt0</span>,</span><span class="param">	<span class="n">lng1</span>,</span><span class="param">	<span class="n">lat1</span>,</span><span class="param">	<span class="n">alt1</span>,</span><span class="param">	<span class="n">resolution_meters</span><span class="o">=</span><span class="mf">400.0</span>,</span><span class="param">	<span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">8494667.0</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_los-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_los"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_los-355"><a href="#plot_los-355"><span class="linenos">355</span></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lng1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">alt1</span><span class="p">,</span> <span class="n">resolution_meters</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">):</span>
</span><span id="plot_los-356"><a href="#plot_los-356"><span class="linenos">356</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_los-357"><a href="#plot_los-357"><span class="linenos">357</span></a><span class="sd">    Plot the Line of Sight (LOS) between two points, showing terrain and LOS altitudes.</span>
</span><span id="plot_los-358"><a href="#plot_los-358"><span class="linenos">358</span></a><span class="sd">    </span>
</span><span id="plot_los-359"><a href="#plot_los-359"><span class="linenos">359</span></a><span class="sd">    Parameters:</span>
</span><span id="plot_los-360"><a href="#plot_los-360"><span class="linenos">360</span></a><span class="sd">    - shm_dtm_user: Shared memory DTM user object for terrain data access (Shm_Dtm_User).</span>
</span><span id="plot_los-361"><a href="#plot_los-361"><span class="linenos">361</span></a><span class="sd">    - lng0: Longitude of the origin point in degrees (float).</span>
</span><span id="plot_los-362"><a href="#plot_los-362"><span class="linenos">362</span></a><span class="sd">    - lat0: Latitude of the origin point in degrees (float).</span>
</span><span id="plot_los-363"><a href="#plot_los-363"><span class="linenos">363</span></a><span class="sd">    - alt0: Altitude of the origin point in meters (float).</span>
</span><span id="plot_los-364"><a href="#plot_los-364"><span class="linenos">364</span></a><span class="sd">    - lng1: Longitude of the target point in degrees (float).</span>
</span><span id="plot_los-365"><a href="#plot_los-365"><span class="linenos">365</span></a><span class="sd">    - lat1: Latitude of the target point in degrees (float).</span>
</span><span id="plot_los-366"><a href="#plot_los-366"><span class="linenos">366</span></a><span class="sd">    - alt1: Altitude of the target point in meters (float).</span>
</span><span id="plot_los-367"><a href="#plot_los-367"><span class="linenos">367</span></a><span class="sd">    - resolution_meters: Sampling resolution along the LOS in meters, default 400 (float).</span>
</span><span id="plot_los-368"><a href="#plot_los-368"><span class="linenos">368</span></a><span class="sd">    - R: Radius adjusted for refraction in meters, default R_RADIO (float32).</span>
</span><span id="plot_los-369"><a href="#plot_los-369"><span class="linenos">369</span></a><span class="sd">    </span>
</span><span id="plot_los-370"><a href="#plot_los-370"><span class="linenos">370</span></a><span class="sd">    Returns:</span>
</span><span id="plot_los-371"><a href="#plot_los-371"><span class="linenos">371</span></a><span class="sd">    - dist: Total distance from origin to target in meters (float).</span>
</span><span id="plot_los-372"><a href="#plot_los-372"><span class="linenos">372</span></a><span class="sd">    </span>
</span><span id="plot_los-373"><a href="#plot_los-373"><span class="linenos">373</span></a><span class="sd">    Notes:</span>
</span><span id="plot_los-374"><a href="#plot_los-374"><span class="linenos">374</span></a><span class="sd">    - Plots terrain relief and LOS altitudes against distance, longitude, and latitude.</span>
</span><span id="plot_los-375"><a href="#plot_los-375"><span class="linenos">375</span></a><span class="sd">    - Uses shared memory DTM for terrain data access.</span>
</span><span id="plot_los-376"><a href="#plot_los-376"><span class="linenos">376</span></a><span class="sd">    - alts_virt and straight are set to 0 and unused in active plotting.</span>
</span><span id="plot_los-377"><a href="#plot_los-377"><span class="linenos">377</span></a><span class="sd">    - Suggestion: Remove commented-out plt.plot lines and unused alts_virt/straight if not needed.</span>
</span><span id="plot_los-378"><a href="#plot_los-378"><span class="linenos">378</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_los-379"><a href="#plot_los-379"><span class="linenos">379</span></a>    <span class="c1">#logging.info(f&#39;[lng0, lat0, alt0], [lng1, lat1, alt1], resolution_meters:\n{[lng0, lat0, alt0]}\n{[lng1, lat1, alt1]}\n{resolution_meters}&#39;)</span>
</span><span id="plot_los-380"><a href="#plot_los-380"><span class="linenos">380</span></a>    <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lng1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alt1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="plot_los-381"><a href="#plot_los-381"><span class="linenos">381</span></a>
</span><span id="plot_los-382"><a href="#plot_los-382"><span class="linenos">382</span></a>    <span class="n">lngss_los</span><span class="p">,</span> <span class="n">latss_los</span><span class="p">,</span> <span class="n">altss_los</span><span class="p">,</span> <span class="n">altss_relief</span><span class="p">,</span> <span class="n">xs_samples</span><span class="p">,</span> <span class="n">ys_samples</span><span class="p">,</span> <span class="n">zs_samples</span><span class="p">,</span> <span class="n">dists_tot</span> <span class="o">=</span> \
</span><span id="plot_los-383"><a href="#plot_los-383"><span class="linenos">383</span></a>        <span class="n">compute_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_1d_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_indices_array</span><span class="p">,</span>
</span><span id="plot_los-384"><a href="#plot_los-384"><span class="linenos">384</span></a>                    <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_nrows_array</span><span class="p">,</span> <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">tiles_ncols_array</span><span class="p">,</span>
</span><span id="plot_los-385"><a href="#plot_los-385"><span class="linenos">385</span></a>                    <span class="n">lng0</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">alt0</span><span class="p">,</span> <span class="n">lngs1</span><span class="p">,</span> <span class="n">lats1</span><span class="p">,</span> <span class="n">alts1</span><span class="p">,</span> <span class="n">resolution_meters</span><span class="p">)</span>
</span><span id="plot_los-386"><a href="#plot_los-386"><span class="linenos">386</span></a>    
</span><span id="plot_los-387"><a href="#plot_los-387"><span class="linenos">387</span></a>    <span class="n">x_samples</span><span class="p">,</span> <span class="n">y_samples</span><span class="p">,</span> <span class="n">z_samples</span> <span class="o">=</span> <span class="n">xs_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zs_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1"># note: keeping the 1s and unique target point</span>
</span><span id="plot_los-388"><a href="#plot_los-388"><span class="linenos">388</span></a>    <span class="n">lngs_los</span><span class="p">,</span> <span class="n">lats_los</span><span class="p">,</span> <span class="n">alts_los</span><span class="p">,</span> <span class="n">alts_relief</span> <span class="o">=</span> <span class="n">lngss_los</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latss_los</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">altss_los</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">altss_relief</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># note: keeping the 1s and unique target point</span>
</span><span id="plot_los-389"><a href="#plot_los-389"><span class="linenos">389</span></a>
</span><span id="plot_los-390"><a href="#plot_los-390"><span class="linenos">390</span></a>    <span class="n">dists</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_samples</span> <span class="o">-</span> <span class="n">x_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_samples</span> <span class="o">-</span> <span class="n">y_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_samples</span> <span class="o">-</span> <span class="n">z_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="plot_los-391"><a href="#plot_los-391"><span class="linenos">391</span></a>    <span class="n">dh</span>        <span class="o">=</span> <span class="n">delta_h</span><span class="p">(</span><span class="n">R_EARTH</span><span class="p">,</span> <span class="n">R_EARTH</span><span class="o">*</span><span class="n">RADIUS_RATIO</span><span class="p">,</span> <span class="n">dists_tot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="plot_los-392"><a href="#plot_los-392"><span class="linenos">392</span></a>    <span class="n">alts_los</span> <span class="o">+=</span> <span class="n">dh</span>
</span><span id="plot_los-393"><a href="#plot_los-393"><span class="linenos">393</span></a>
</span><span id="plot_los-394"><a href="#plot_los-394"><span class="linenos">394</span></a>    <span class="n">alts_virt</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># R_EARTH**2/np.sqrt(R_EARTH**2-(dists-dist_tot/2)**2) - R_EARTH</span>
</span><span id="plot_los-395"><a href="#plot_los-395"><span class="linenos">395</span></a>    <span class="n">straight</span>  <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># np.interp(dists, [dists[0], dists[-1]], [alts_los[0] - alts_virt[0], 0])</span>
</span><span id="plot_los-396"><a href="#plot_los-396"><span class="linenos">396</span></a>    <span class="c1"># plt.plot(dists, alts_relief-alts_los+0 +straight, &#39;b.-&#39;, label=&#39;relief&#39;)</span>
</span><span id="plot_los-397"><a href="#plot_los-397"><span class="linenos">397</span></a>    <span class="c1"># plt.plot(dists, alts_los   -alts_los+dh+straight, &#39;k.-&#39;, label=&#39;line of sight&#39;)</span>
</span><span id="plot_los-398"><a href="#plot_los-398"><span class="linenos">398</span></a>    <span class="c1"># Note: Above plt.plot lines are commented out and unused.</span>
</span><span id="plot_los-399"><a href="#plot_los-399"><span class="linenos">399</span></a>    <span class="c1"># Suggestion: Remove if not intended for future use.</span>
</span><span id="plot_los-400"><a href="#plot_los-400"><span class="linenos">400</span></a>    <span class="n">fig</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
</span><span id="plot_los-401"><a href="#plot_los-401"><span class="linenos">401</span></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
</span><span id="plot_los-402"><a href="#plot_los-402"><span class="linenos">402</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">alts_relief</span><span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;relief&#39;</span><span class="p">)</span>
</span><span id="plot_los-403"><a href="#plot_los-403"><span class="linenos">403</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">alts_los</span>   <span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;line of sight&#39;</span><span class="p">)</span>
</span><span id="plot_los-404"><a href="#plot_los-404"><span class="linenos">404</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="plot_los-405"><a href="#plot_los-405"><span class="linenos">405</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="plot_los-406"><a href="#plot_los-406"><span class="linenos">406</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
</span><span id="plot_los-407"><a href="#plot_los-407"><span class="linenos">407</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (m)&#39;</span><span class="p">)</span>
</span><span id="plot_los-408"><a href="#plot_los-408"><span class="linenos">408</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Altitude (m)&#39;</span><span class="p">)</span>
</span><span id="plot_los-409"><a href="#plot_los-409"><span class="linenos">409</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="plot_los-410"><a href="#plot_los-410"><span class="linenos">410</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="c1"># Shows gridlines for both major and minor ticks</span>
</span><span id="plot_los-411"><a href="#plot_los-411"><span class="linenos">411</span></a>
</span><span id="plot_los-412"><a href="#plot_los-412"><span class="linenos">412</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lngs_los</span><span class="p">,</span> <span class="n">alts_relief</span><span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="plot_los-413"><a href="#plot_los-413"><span class="linenos">413</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lngs_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lngs_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">)</span>
</span><span id="plot_los-414"><a href="#plot_los-414"><span class="linenos">414</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lngs_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lngs_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="plot_los-415"><a href="#plot_los-415"><span class="linenos">415</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
</span><span id="plot_los-416"><a href="#plot_los-416"><span class="linenos">416</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
</span><span id="plot_los-417"><a href="#plot_los-417"><span class="linenos">417</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="c1"># Shows gridlines for both major and minor ticks</span>
</span><span id="plot_los-418"><a href="#plot_los-418"><span class="linenos">418</span></a>    
</span><span id="plot_los-419"><a href="#plot_los-419"><span class="linenos">419</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lats_los</span><span class="p">,</span> <span class="n">alts_relief</span><span class="o">-</span><span class="n">alts_virt</span><span class="o">-</span><span class="n">straight</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="plot_los-420"><a href="#plot_los-420"><span class="linenos">420</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lats_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lats_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">)</span>
</span><span id="plot_los-421"><a href="#plot_los-421"><span class="linenos">421</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lats_los</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">3e-4</span><span class="p">,</span> <span class="n">lats_los</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">3e-4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="plot_los-422"><a href="#plot_los-422"><span class="linenos">422</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
</span><span id="plot_los-423"><a href="#plot_los-423"><span class="linenos">423</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
</span><span id="plot_los-424"><a href="#plot_los-424"><span class="linenos">424</span></a>    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span> <span class="c1"># Shows gridlines for both major and minor ticks</span>
</span><span id="plot_los-425"><a href="#plot_los-425"><span class="linenos">425</span></a>
</span><span id="plot_los-426"><a href="#plot_los-426"><span class="linenos">426</span></a>    <span class="k">return</span> <span class="n">dists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Plot the Line of Sight (LOS) between two points, showing terrain and LOS altitudes.</p>

<p>Parameters:</p>

<ul>
<li>shm_dtm_user: Shared memory DTM user object for terrain data access (Shm_Dtm_User).</li>
<li>lng0: Longitude of the origin point in degrees (float).</li>
<li>lat0: Latitude of the origin point in degrees (float).</li>
<li>alt0: Altitude of the origin point in meters (float).</li>
<li>lng1: Longitude of the target point in degrees (float).</li>
<li>lat1: Latitude of the target point in degrees (float).</li>
<li>alt1: Altitude of the target point in meters (float).</li>
<li>resolution_meters: Sampling resolution along the LOS in meters, default 400 (float).</li>
<li>R: Radius adjusted for refraction in meters, default R_RADIO (float32).</li>
</ul>

<p>Returns:</p>

<ul>
<li>dist: Total distance from origin to target in meters (float).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Plots terrain relief and LOS altitudes against distance, longitude, and latitude.</li>
<li>Uses shared memory DTM for terrain data access.</li>
<li>alts_virt and straight are set to 0 and unused in active plotting.</li>
<li>Suggestion: Remove commented-out plt.plot lines and unused alts_virt/straight if not needed.</li>
</ul>
</div>


                </section>
                <section id="cur_fig_num">
                    <div class="attr variable">
            <span class="name">cur_fig_num</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#cur_fig_num"></a>
    
    

                </section>
                <section id="submain">
                            <input id="submain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">submain</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shm_dtm_user</span>, </span><span class="param"><span class="n">m1</span>, </span><span class="param"><span class="n">m2</span>, </span><span class="param"><span class="n">m3</span>, </span><span class="param"><span class="n">n_points</span><span class="o">=</span><span class="mi">1000</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="submain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#submain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="submain-430"><a href="#submain-430"><span class="linenos">430</span></a><span class="k">def</span><span class="w"> </span><span class="nf">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
</span><span id="submain-431"><a href="#submain-431"><span class="linenos">431</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="submain-432"><a href="#submain-432"><span class="linenos">432</span></a><span class="sd">    Test intervisibility for multiple points with visualization using shared memory DTM.</span>
</span><span id="submain-433"><a href="#submain-433"><span class="linenos">433</span></a><span class="sd">    </span>
</span><span id="submain-434"><a href="#submain-434"><span class="linenos">434</span></a><span class="sd">    Parameters:</span>
</span><span id="submain-435"><a href="#submain-435"><span class="linenos">435</span></a><span class="sd">    - shm_dtm_user: Shared memory DTM user object for terrain data access (Shm_Dtm_User).</span>
</span><span id="submain-436"><a href="#submain-436"><span class="linenos">436</span></a><span class="sd">    - m1: Named tuple with lon, lat, alt for the origin point.</span>
</span><span id="submain-437"><a href="#submain-437"><span class="linenos">437</span></a><span class="sd">    - m2, m3: Named tuples with lon, lat, alt defining the range of target points.</span>
</span><span id="submain-438"><a href="#submain-438"><span class="linenos">438</span></a><span class="sd">    - n_points: Number of points to generate in the grid (default: 1000).</span>
</span><span id="submain-439"><a href="#submain-439"><span class="linenos">439</span></a><span class="sd">    </span>
</span><span id="submain-440"><a href="#submain-440"><span class="linenos">440</span></a><span class="sd">    Notes:</span>
</span><span id="submain-441"><a href="#submain-441"><span class="linenos">441</span></a><span class="sd">    - Generates a grid of target points and checks intervisibility.</span>
</span><span id="submain-442"><a href="#submain-442"><span class="linenos">442</span></a><span class="sd">    - Includes visualization using Matplotlib, which may be unnecessary in CLI context.</span>
</span><span id="submain-443"><a href="#submain-443"><span class="linenos">443</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="submain-444"><a href="#submain-444"><span class="linenos">444</span></a>    <span class="k">global</span> <span class="n">cur_fig_num</span>
</span><span id="submain-445"><a href="#submain-445"><span class="linenos">445</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;------------- submain&#39;</span><span class="p">)</span>
</span><span id="submain-446"><a href="#submain-446"><span class="linenos">446</span></a>    
</span><span id="submain-447"><a href="#submain-447"><span class="linenos">447</span></a>    <span class="c1"># Define origin point</span>
</span><span id="submain-448"><a href="#submain-448"><span class="linenos">448</span></a>    <span class="n">m23_lngs</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="submain-449"><a href="#submain-449"><span class="linenos">449</span></a>    <span class="n">m23_lats</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="submain-450"><a href="#submain-450"><span class="linenos">450</span></a>    <span class="n">m23_alts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="submain-451"><a href="#submain-451"><span class="linenos">451</span></a>
</span><span id="submain-452"><a href="#submain-452"><span class="linenos">452</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Perform intervisibility check: </span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="s1"> ; (</span><span class="si">{</span><span class="n">m2</span><span class="o">.</span><span class="n">lon</span><span class="si">}</span><span class="s1">..</span><span class="si">{</span><span class="n">m3</span><span class="o">.</span><span class="n">lon</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m2</span><span class="o">.</span><span class="n">lat</span><span class="si">}</span><span class="s1">..</span><span class="si">{</span><span class="n">m3</span><span class="o">.</span><span class="n">lat</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m2</span><span class="o">.</span><span class="n">alt</span><span class="si">}</span><span class="s1">..</span><span class="si">{</span><span class="n">m3</span><span class="o">.</span><span class="n">alt</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="submain-453"><a href="#submain-453"><span class="linenos">453</span></a>    <span class="n">distances</span>           <span class="o">=</span> <span class="n">straight_line_distances</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_lngs</span><span class="p">,</span> <span class="n">m23_lats</span><span class="p">,</span> <span class="n">m23_alts</span><span class="p">)</span>
</span><span id="submain-454"><a href="#submain-454"><span class="linenos">454</span></a>    <span class="n">intervisi_distances</span> <span class="o">=</span> <span class="n">horizon_intervisibility_distances</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_alts</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="submain-455"><a href="#submain-455"><span class="linenos">455</span></a>
</span><span id="submain-456"><a href="#submain-456"><span class="linenos">456</span></a>    <span class="c1"># Test vectorized intervisibility</span>
</span><span id="submain-457"><a href="#submain-457"><span class="linenos">457</span></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="submain-458"><a href="#submain-458"><span class="linenos">458</span></a>    <span class="n">intervisibilities</span>   <span class="o">=</span> <span class="n">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_lngs</span><span class="p">,</span> <span class="n">m23_lats</span><span class="p">,</span> <span class="n">m23_alts</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="submain-459"><a href="#submain-459"><span class="linenos">459</span></a>    <span class="n">execution_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="submain-460"><a href="#submain-460"><span class="linenos">460</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time for intervisibility check: </span><span class="si">{</span><span class="n">execution_time</span><span class="o">*</span><span class="mf">1000.</span><span class="si">:</span><span class="s1">10.3f</span><span class="si">}</span><span class="s1">ms&#39;</span><span class="p">)</span>
</span><span id="submain-461"><a href="#submain-461"><span class="linenos">461</span></a>
</span><span id="submain-462"><a href="#submain-462"><span class="linenos">462</span></a>    <span class="c1"># Initialize plot</span>
</span><span id="submain-463"><a href="#submain-463"><span class="linenos">463</span></a>    <span class="n">cur_fig_num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="submain-464"><a href="#submain-464"><span class="linenos">464</span></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;los</span><span class="si">{</span><span class="n">cur_fig_num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="submain-465"><a href="#submain-465"><span class="linenos">465</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="submain-466"><a href="#submain-466"><span class="linenos">466</span></a>
</span><span id="submain-467"><a href="#submain-467"><span class="linenos">467</span></a>    <span class="n">r_</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
</span><span id="submain-468"><a href="#submain-468"><span class="linenos">468</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
</span><span id="submain-469"><a href="#submain-469"><span class="linenos">469</span></a>        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">r_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
</span><span id="submain-470"><a href="#submain-470"><span class="linenos">470</span></a>        <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
</span><span id="submain-471"><a href="#submain-471"><span class="linenos">471</span></a>        <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="submain-472"><a href="#submain-472"><span class="linenos">472</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- [</span><span class="si">{</span><span class="n">idx</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">] Dist intervisi theo: </span><span class="si">{</span><span class="p">(</span><span class="n">intervisi_distances</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span><span class="si">:</span><span class="s1">8.3f</span><span class="si">}</span><span class="s1"> km&#39;</span><span class="p">)</span>
</span><span id="submain-473"><a href="#submain-473"><span class="linenos">473</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;         Dist entre points  : </span><span class="si">{</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span><span class="si">:</span><span class="s1">8.3f</span><span class="si">}</span><span class="s1"> km&#39;</span><span class="p">)</span>
</span><span id="submain-474"><a href="#submain-474"><span class="linenos">474</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;         Intervisibility    : </span><span class="si">{</span><span class="n">intervisibilities</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="submain-475"><a href="#submain-475"><span class="linenos">475</span></a>
</span><span id="submain-476"><a href="#submain-476"><span class="linenos">476</span></a>            <span class="n">plot_los</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m23_lngs</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m23_lats</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m23_alts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="submain-477"><a href="#submain-477"><span class="linenos">477</span></a>
</span><span id="submain-478"><a href="#submain-478"><span class="linenos">478</span></a>    <span class="c1"># Note: Legend removal is redundant as plot_los manages legends.</span>
</span><span id="submain-479"><a href="#submain-479"><span class="linenos">479</span></a>    <span class="c1"># Suggestion: Remove this line as it may raise an error if no legend exists.</span>
</span><span id="submain-480"><a href="#submain-480"><span class="linenos">480</span></a>    <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Test intervisibility for multiple points with visualization using shared memory DTM.</p>

<p>Parameters:</p>

<ul>
<li>shm_dtm_user: Shared memory DTM user object for terrain data access (Shm_Dtm_User).</li>
<li>m1: Named tuple with lon, lat, alt for the origin point.</li>
<li>m2, m3: Named tuples with lon, lat, alt defining the range of target points.</li>
<li>n_points: Number of points to generate in the grid (default: 1000).</li>
</ul>

<p>Notes:</p>

<ul>
<li>Generates a grid of target points and checks intervisibility.</li>
<li>Includes visualization using Matplotlib, which may be unnecessary in CLI context.</li>
</ul>
</div>


                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-483"><a href="#main-483"><span class="linenos">483</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="main-484"><a href="#main-484"><span class="linenos">484</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-485"><a href="#main-485"><span class="linenos">485</span></a><span class="sd">    Parse command-line arguments and execute the intervisibility computation.</span>
</span><span id="main-486"><a href="#main-486"><span class="linenos">486</span></a><span class="sd">    </span>
</span><span id="main-487"><a href="#main-487"><span class="linenos">487</span></a><span class="sd">    Notes:</span>
</span><span id="main-488"><a href="#main-488"><span class="linenos">488</span></a><span class="sd">    - Initializes the shared memory DTM interface.</span>
</span><span id="main-489"><a href="#main-489"><span class="linenos">489</span></a><span class="sd">    - Processes input coordinates and resolution.</span>
</span><span id="main-490"><a href="#main-490"><span class="linenos">490</span></a><span class="sd">    - Outputs the intervisibility result and cleans up resources.</span>
</span><span id="main-491"><a href="#main-491"><span class="linenos">491</span></a><span class="sd">    - Calls submain and submain2 for additional testing.</span>
</span><span id="main-492"><a href="#main-492"><span class="linenos">492</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="main-493"><a href="#main-493"><span class="linenos">493</span></a>    <span class="c1"># Define CLI argument parser with detailed help messages</span>
</span><span id="main-494"><a href="#main-494"><span class="linenos">494</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
</span><span id="main-495"><a href="#main-495"><span class="linenos">495</span></a>        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Calculate Line of Sight (LOS) intervisibility using shared memory DTM.&#39;</span><span class="p">,</span>
</span><span id="main-496"><a href="#main-496"><span class="linenos">496</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
</span><span id="main-497"><a href="#main-497"><span class="linenos">497</span></a>        <span class="n">epilog</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
</span><span id="main-498"><a href="#main-498"><span class="linenos">498</span></a><span class="s1">Example:</span>
</span><span id="main-499"><a href="#main-499"><span class="linenos">499</span></a><span class="s1">    python -m Line_Of_Sight.line_of_sight --tiles_1d_array shm1 --tiles_indices shm2 --tiles_nrows shm3 --tiles_ncols shm4 --origin -3.2 47.5 30 --target -3.3 47.6 60</span>
</span><span id="main-500"><a href="#main-500"><span class="linenos">500</span></a>
</span><span id="main-501"><a href="#main-501"><span class="linenos">501</span></a><span class="s1">Notes:</span>
</span><span id="main-502"><a href="#main-502"><span class="linenos">502</span></a><span class="s1">    - Shared memory blocks must be pre-allocated and accessible.</span>
</span><span id="main-503"><a href="#main-503"><span class="linenos">503</span></a><span class="s1">    - Coordinates should be provided in decimal degrees (longitude, latitude) and meters (altitude).</span>
</span><span id="main-504"><a href="#main-504"><span class="linenos">504</span></a><span class="s1">    - Resolution affects the granularity of LOS sampling; lower values increase accuracy but increase computation time.</span>
</span><span id="main-505"><a href="#main-505"><span class="linenos">505</span></a><span class="s1">&#39;&#39;&#39;</span>
</span><span id="main-506"><a href="#main-506"><span class="linenos">506</span></a>    <span class="p">)</span>
</span><span id="main-507"><a href="#main-507"><span class="linenos">507</span></a>
</span><span id="main-508"><a href="#main-508"><span class="linenos">508</span></a>    <span class="c1"># Define required and optional arguments</span>
</span><span id="main-509"><a href="#main-509"><span class="linenos">509</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_1d_array&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing DTM tile data&#39;</span><span class="p">)</span>
</span><span id="main-510"><a href="#main-510"><span class="linenos">510</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_indices&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing tile indices&#39;</span><span class="p">)</span>
</span><span id="main-511"><a href="#main-511"><span class="linenos">511</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_nrows&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing tile row counts&#39;</span><span class="p">)</span>
</span><span id="main-512"><a href="#main-512"><span class="linenos">512</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tiles_ncols&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Shared memory block containing tile column counts&#39;</span><span class="p">)</span>
</span><span id="main-513"><a href="#main-513"><span class="linenos">513</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--origin&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LON&#39;</span><span class="p">,</span> <span class="s1">&#39;LAT&#39;</span><span class="p">,</span> <span class="s1">&#39;ALT&#39;</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="main-514"><a href="#main-514"><span class="linenos">514</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Origin point coordinates: longitude (degrees), latitude (degrees), altitude (meters)&#39;</span><span class="p">)</span>
</span><span id="main-515"><a href="#main-515"><span class="linenos">515</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--target&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;LON&#39;</span><span class="p">,</span> <span class="s1">&#39;LAT&#39;</span><span class="p">,</span> <span class="s1">&#39;ALT&#39;</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="main-516"><a href="#main-516"><span class="linenos">516</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Target point coordinates: longitude (degrees), latitude (degrees), altitude (meters)&#39;</span><span class="p">)</span>
</span><span id="main-517"><a href="#main-517"><span class="linenos">517</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--resolution&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
</span><span id="main-518"><a href="#main-518"><span class="linenos">518</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Sampling resolution along the LOS in meters (default: 400)&#39;</span><span class="p">)</span>
</span><span id="main-519"><a href="#main-519"><span class="linenos">519</span></a>
</span><span id="main-520"><a href="#main-520"><span class="linenos">520</span></a>    <span class="c1"># Parse command-line arguments</span>
</span><span id="main-521"><a href="#main-521"><span class="linenos">521</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="main-522"><a href="#main-522"><span class="linenos">522</span></a>    
</span><span id="main-523"><a href="#main-523"><span class="linenos">523</span></a>    <span class="c1"># Initialize shared memory DTM interface with provided blocks</span>
</span><span id="main-524"><a href="#main-524"><span class="linenos">524</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">resource_tracker</span>
</span><span id="main-525"><a href="#main-525"><span class="linenos">525</span></a>    <span class="n">resource_tracker</span><span class="o">.</span><span class="n">register</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">rtype</span><span class="p">:</span> <span class="kc">None</span>
</span><span id="main-526"><a href="#main-526"><span class="linenos">526</span></a>    
</span><span id="main-527"><a href="#main-527"><span class="linenos">527</span></a>    <span class="n">shm_dtm_user</span> <span class="o">=</span> <span class="n">Shm_Dtm_User</span><span class="p">({</span><span class="s2">&quot;tiles_1d_array&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_1d_array</span><span class="p">,</span>
</span><span id="main-528"><a href="#main-528"><span class="linenos">528</span></a>                                 <span class="s2">&quot;tiles_indices&quot;</span> <span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_indices</span><span class="p">,</span>
</span><span id="main-529"><a href="#main-529"><span class="linenos">529</span></a>                                 <span class="s2">&quot;tiles_nrows&quot;</span>   <span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_nrows</span><span class="p">,</span>
</span><span id="main-530"><a href="#main-530"><span class="linenos">530</span></a>                                 <span class="s2">&quot;tiles_ncols&quot;</span>   <span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">tiles_ncols</span><span class="p">})</span>
</span><span id="main-531"><a href="#main-531"><span class="linenos">531</span></a>        
</span><span id="main-532"><a href="#main-532"><span class="linenos">532</span></a>    <span class="c1"># Run test functions</span>
</span><span id="main-533"><a href="#main-533"><span class="linenos">533</span></a>    <span class="n">Point</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;alt&#39;</span><span class="p">])</span>
</span><span id="main-534"><a href="#main-534"><span class="linenos">534</span></a>
</span><span id="main-535"><a href="#main-535"><span class="linenos">535</span></a>    <span class="n">resolution_m</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="main-536"><a href="#main-536"><span class="linenos">536</span></a>
</span><span id="main-537"><a href="#main-537"><span class="linenos">537</span></a>    <span class="c1"># Warm up the JIT compiler</span>
</span><span id="main-538"><a href="#main-538"><span class="linenos">538</span></a>    <span class="n">m1</span>  <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">180.</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">)</span>
</span><span id="main-539"><a href="#main-539"><span class="linenos">539</span></a>    <span class="n">m2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">10000.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="main-540"><a href="#main-540"><span class="linenos">540</span></a>    <span class="n">intervisibilities</span>   <span class="o">=</span> <span class="n">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">m2s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m2s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m2s</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="main-541"><a href="#main-541"><span class="linenos">541</span></a>
</span><span id="main-542"><a href="#main-542"><span class="linenos">542</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">origin</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
</span><span id="main-543"><a href="#main-543"><span class="linenos">543</span></a>        <span class="n">m1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
</span><span id="main-544"><a href="#main-544"><span class="linenos">544</span></a>        <span class="n">m2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</span><span id="main-545"><a href="#main-545"><span class="linenos">545</span></a>        <span class="n">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="main-546"><a href="#main-546"><span class="linenos">546</span></a>
</span><span id="main-547"><a href="#main-547"><span class="linenos">547</span></a>    <span class="n">m1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">12.2</span><span class="p">,</span> <span class="mf">47.5</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">)</span>
</span><span id="main-548"><a href="#main-548"><span class="linenos">548</span></a>    <span class="n">m2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">6.0</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="mf">6.1</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="mf">10.</span><span class="p">)</span>
</span><span id="main-549"><a href="#main-549"><span class="linenos">549</span></a>    <span class="n">m3</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">6.3</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="mf">6.4</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="mf">100.</span><span class="p">)</span>
</span><span id="main-550"><a href="#main-550"><span class="linenos">550</span></a>    <span class="n">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="main-551"><a href="#main-551"><span class="linenos">551</span></a>
</span><span id="main-552"><a href="#main-552"><span class="linenos">552</span></a>    <span class="n">m1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">4.42</span><span class="p">,</span> <span class="mf">48.38</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
</span><span id="main-553"><a href="#main-553"><span class="linenos">553</span></a>    <span class="n">m3</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">4.47</span><span class="p">,</span> <span class="mf">47.94</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
</span><span id="main-554"><a href="#main-554"><span class="linenos">554</span></a>    <span class="n">m2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">0.9</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">alt</span><span class="p">)</span>
</span><span id="main-555"><a href="#main-555"><span class="linenos">555</span></a>    <span class="n">submain</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="main-556"><a href="#main-556"><span class="linenos">556</span></a>
</span><span id="main-557"><a href="#main-557"><span class="linenos">557</span></a>    <span class="c1"># Loop to test intervisibility for multiple random points</span>
</span><span id="main-558"><a href="#main-558"><span class="linenos">558</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Testing intervisibility for multiple random points...&#39;</span><span class="p">)</span>
</span><span id="main-559"><a href="#main-559"><span class="linenos">559</span></a>    <span class="n">m1_size</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="main-560"><a href="#main-560"><span class="linenos">560</span></a>    <span class="n">m1s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span>   <span class="mf">180.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">m1_size</span><span class="p">),</span>
</span><span id="main-561"><a href="#main-561"><span class="linenos">561</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span> <span class="o">-</span><span class="mf">80.</span><span class="p">,</span>    <span class="mf">80.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">m1_size</span><span class="p">),</span>
</span><span id="main-562"><a href="#main-562"><span class="linenos">562</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">20000.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">m1_size</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="main-563"><a href="#main-563"><span class="linenos">563</span></a>
</span><span id="main-564"><a href="#main-564"><span class="linenos">564</span></a>    <span class="n">m2_size</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="main-565"><a href="#main-565"><span class="linenos">565</span></a>    <span class="n">deviations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">m1_size</span><span class="p">,</span> <span class="n">m2_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="main-566"><a href="#main-566"><span class="linenos">566</span></a>    <span class="n">m2ss</span> <span class="o">=</span> <span class="n">m1s</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="n">deviations</span>
</span><span id="main-567"><a href="#main-567"><span class="linenos">567</span></a>
</span><span id="main-568"><a href="#main-568"><span class="linenos">568</span></a>    <span class="n">execution_times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="main-569"><a href="#main-569"><span class="linenos">569</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">m2_size</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">m2_size</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Compute intervisibility and measure execution time for each point&quot;</span><span class="p">):</span>
</span><span id="main-570"><a href="#main-570"><span class="linenos">570</span></a>        <span class="c1"># For each point, compute intervisibility and measure execution time</span>
</span><span id="main-571"><a href="#main-571"><span class="linenos">571</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="main-572"><a href="#main-572"><span class="linenos">572</span></a>        <span class="n">intervisibilities</span> <span class="o">=</span> <span class="n">are_intervisible</span><span class="p">(</span><span class="n">shm_dtm_user</span><span class="p">,</span>
</span><span id="main-573"><a href="#main-573"><span class="linenos">573</span></a>                                             <span class="n">m1s</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m1s</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m1s</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span>
</span><span id="main-574"><a href="#main-574"><span class="linenos">574</span></a>                                             <span class="n">m2ss</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m2ss</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">m2ss</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">R</span><span class="o">=</span><span class="n">R_RADIO</span><span class="p">)</span>
</span><span id="main-575"><a href="#main-575"><span class="linenos">575</span></a>        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</span><span id="main-576"><a href="#main-576"><span class="linenos">576</span></a>        <span class="n">execution_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">execution_time</span><span class="p">)</span>
</span><span id="main-577"><a href="#main-577"><span class="linenos">577</span></a>    
</span><span id="main-578"><a href="#main-578"><span class="linenos">578</span></a>    <span class="n">execution_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.</span>  <span class="c1"># Convert to milliseconds</span>
</span><span id="main-579"><a href="#main-579"><span class="linenos">579</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of time entries             : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-580"><a href="#main-580"><span class="linenos">580</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of line-of-sight per entries: </span><span class="si">{</span><span class="n">m2_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-581"><a href="#main-581"><span class="linenos">581</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total time                         : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="main-582"><a href="#main-582"><span class="linenos">582</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean time                          : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="main-583"><a href="#main-583"><span class="linenos">583</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard deviation                 : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="main-584"><a href="#main-584"><span class="linenos">584</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum time                       : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="main-585"><a href="#main-585"><span class="linenos">585</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum time                       : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">execution_times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="main-586"><a href="#main-586"><span class="linenos">586</span></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;99th percentile time               : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">execution_times</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</span><span id="main-587"><a href="#main-587"><span class="linenos">587</span></a>
</span><span id="main-588"><a href="#main-588"><span class="linenos">588</span></a>    <span class="c1"># Close shared memory resources to prevent memory leaks</span>
</span><span id="main-589"><a href="#main-589"><span class="linenos">589</span></a>    <span class="n">shm_dtm_user</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Parse command-line arguments and execute the intervisibility computation.</p>

<p>Notes:</p>

<ul>
<li>Initializes the shared memory DTM interface.</li>
<li>Processes input coordinates and resolution.</li>
<li>Outputs the intervisibility result and cleans up resources.</li>
<li>Calls submain and submain2 for additional testing.</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>